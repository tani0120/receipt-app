# UI実装タスク（L2：カテゴリー別、永続）

> [!NOTE]
> ## 📋 このファイルの位置づけ
> - **階層**: L2（カテゴリー別タスク、永続）
> - **役割**: UI実装の詳細タスク管理
> - **同期**:
>   - **上位**: UI_MASTER_v2.md（L1、Milestone完了時に同期）
>   - **下位**: task.md（L3、セッション終了時に集約）
> - **ルール**: 急遽問題が発生してもこのファイルは影響を受けない

**最終更新**: 2026-01-26  
**カテゴリー**: UI実装  
**Phase**: 1  
**優先度**: P1

---

## 🎯 現在の進捗（横断的）

**Milestone 1.1進捗**: 3/4 Step完了（**75%**）  
**Phase 1全体進捗**: 3/9 Step完了（**33%**）

**次のステップ**: Step 4 UIモック（4-6時間）← **今すぐ着手**

**詳細**: [PROJECT_STATUS.md](file:///C:/Users/kazen/.gemini/antigravity/brain/2826535e-a1b5-4cf1-899e-d11b8801f16d/PROJECT_STATUS.md)（L0最上位）

---

## 📊 Phase 1全体進捗

### Milestone 1.1: OCR→仕訳表示（2-3日）
| Step | 内容 | ステータス | 完了日 | 所要時間 |
|------|------|----------|--------|---------|
| Step 1 | スコープ決定 | ✅ 完了 | 2026-01-22 | 1-2時間 |
| Step 2 | L1-3定義 | ✅ 完了 | 2026-01-23 | 3-4時間 |
| Step 3 | AI API実装 | ✅ 完了（TD-001あり） | 2026-01-24 | 4-5時間 |
| Step 4 | UIモック | ← 次 | - | 4-6時間（予定） |

### Milestone 1.2: マスターデータ管理（2-3日）
| Step | 内容 | ステータス | 完了日 | 所要時間 |
|------|------|----------|--------|---------|
| Step 5 | 顧問先CRUD実装 | ⏸️ 待機中 | - | 1日（予定） |
| Step 6 | スタッフCRUD実装 | ⏸️ 待機中 | - | 1日（予定） |

### Milestone 1.3: 仕訳編集（2-3日）
| Step | 内容 | ステータス | 完了日 | 所要時間 |
|------|------|----------|--------|----------|
| Step 7 | 仕訳入力画面実装 | ⏸️ 待機中 | - | 2-3日（予定） |

### Milestone 1.4: CSV出力＋E2Eテスト（1-2日）
| Step | 内容 | ステータス | 完了日 | 所要時間 |
|------|------|----------|--------|----------|
| Step 8 | CSV出力実装 | ⏸️ 待機中 | - | 1日（予定） |
| Step 9 | E2Eテスト | ⏸️ 待機中 | - | 1日（予定） |

**Milestone 1.1進捗**: 3/4 Step完了（75%）  
**Phase 1全体進捗**: 3/9 Step完了（33%）

---

## Step 1: Firebase認証設定 ✅

**ステータス**: 完了  
**完了日**: 2026-01-21  
**所要時間**: 1-2時間

### タスクリスト
- [x] Firebase Auth設定
- [x] Gmail認証実装
- [x] 動作確認

### 成果物
- Firebase Authentication有効化
- Gmail認証プロバイダー設定完了

---

## Step 2: Journal L1-3定義 ✅

**ステータス**: 完了  
**完了日**: 2026-01-23  
**所要時間**: 3-4時間

### JournalEntry（19プロパティ）

| # | プロパティ | 型 | 必須 | Phase | 説明 |
|---|-----------|----|----|-------|------|
| 1 | `id` | string (UUID) | ✅ | 1 | 仕訳エントリのUUID |
| 2 | `date` | string (YYYY-MM-DD) | ✅ | 1 | 取引日付 |
| 3 | `description` | string | ✅ | 1 | 摘要（全行共通） |
| 4 | `totalAmount` | number | ✅ | 1 | 合計金額（税込） |
| 5 | `lines` | JournalLine[] | ✅ | 1 | 仕訳明細行（最小2行） |
| 6 | `clientId` | string | ✅ | 1 | 顧問先ID |
| 7 | `clientCode` | string (3文字) | ✅ | 1 | 顧問先の3コード |
| 8 | `aiSourceType` | enum | ✅ | 1 | gemini/manual/hybrid |
| 9 | `aiConfidence` | number (0-1) | ✅ | 1 | AI信頼度 |
| 10 | `sourceFiles` | SourceFile[] | ✅ | 1 | 証憑ファイル情報 |
| 11 | `createdAt` | string (ISO) | ✅ | 1 | 作成日時 |
| 12 | `createdBy` | string | ✅ | 1 | 作成者ID |
| 13 | `updatedAt` | string (ISO) | ✅ | 1 | 更新日時 |
| 14 | `updatedBy` | string | ⭕ | 1 | 更新者ID |
| 15 | `isConfirmed` | boolean | ✅ | 1 | ユーザー確認済みか |
| 16 | `hasQualifiedInvoice` | boolean | ⭕ | 1 | 適格請求書か |
| 17 | `aiConfidenceBreakdown` | object | ⭕ | 2 | 項目別AI信頼度 |
| 18 | `exportHistory` | object[] | ⭕ | 2 | 出力履歴 |
| 19 | `approvalWorkflow` | object | ⭕ | 2 | 承認ワークフロー |

### JournalLine（16プロパティ）

| # | プロパティ | 型 | 必須 | Phase | 説明 |
|---|-----------|----|----|-------|------|
| 1 | `lineId` | string (UUID) | ✅ | 1 | 行のUUID |
| 2 | `accountCode` | string | ✅ | 1 | 勘定科目コード |
| 3 | `accountName` | string | ✅ | 1 | 勘定科目名 |
| 4 | `subAccount` | string | ⭕ | 1 | 補助科目 |
| 5 | `debit` | number | ✅ | 1 | 借方金額 |
| 6 | `credit` | number | ✅ | 1 | 貸方金額 |
| 7 | `taxType` | enum | ✅ | 1 | none/consumption/reduced |
| 8 | `taxAmountFromDocument` | number | ⭕ | 1 | 証憑記載の税額 |
| 9 | `taxDocumentSource` | enum | ✅ | 1 | 証憑値の取得方法 |
| 10 | `taxAmountCalculated` | number | ✅ | 1 | システム計算の税額 |
| 11 | `taxCalculationMethod` | enum | ✅ | 1 | 計算方法 |
| 12 | `taxAmountFinal` | number | ✅ | 1 | 最終確定税額（CSV出力用） |
| 13 | `taxAmountSource` | enum | ✅ | 1 | 最終値の出所 |
| 14 | `taxDiscrepancy` | object | ⭕ | 1 | 税額ズレ検出結果 |
| 15 | `description` | string | ⭕ | 1 | 行ごとのコメント |
| 16 | `isAIGenerated` | boolean | ✅ | 1 | AI生成か |

### 税額判定戦略C

**原則**: OCR抽出値（記載値）を採用

**検証**: 計算値とのズレを自動検出
- ズレなし / 1円以内 → ✅ OK（自動承認）
- 2-5円 → ⚠️ WARNING（確認推奨）
- 5円超 → ❌ ERROR（修正必須）

**理由**:
- 領収書の原文を尊重（監査対応）
- AI精度を可視化（信頼度表示）
- ユーザーが最終判定（責任の所在）

### タスクリスト
- [x] JournalEntrySchema作成（19プロパティ）
- [x] JournalLineSchema作成（16プロパティ）
- [x] 税額の三重構造定義（証憑値/計算値/最終値）
- [x] 税額判定戦略C確定
- [x] UI表示方針確定

### 履歴
- 2026-01-23: JournalEntry（19プロパティ）、JournalLine（16プロパティ）確定
- 2026-01-23: 税額判定戦略C採用、UI表示方針決定

---

## Step 3: AI API実装 ✅

**ステータス**: 完了（TD-001により一部未完了）  
**開始日**: 2026-01-24  
**完了日**: 2026-01-24  
**所要時間**: 4-5時間

### Phase 1必須実装（MF専用）

**MF 1つでも、以下は必須**:

| 項目 | Phase 1実装 | 理由 |
|------|----------|------|
| NFKC正規化 | ✅ 必須 | MFの取引先マスタ連動に必須 |
| 税区分マッピング | ✅ 必須（MFのみ） | MF形式のCSV出力に必須 |
| CSV物理制約 | ✅ 必須 | 摘要200文字、Shift-JIS変換 |
| インボイス80% | ✅ 必須（固定値） | 2026年9月30日まで |

**Phase 1で実装しなければ、MFへのCSV出力が動作しません。**

### 実装ファイル一覧（Phase 1: 8ファイル）

| # | ファイル | 役割 | 実装優先度 | ステータス | 所要時間 |
|---|---------|------|----------|----------|---------|
| 1 | `GeminiVisionService.ts` | AI処理 | 最高 | ✅ 完了 | 3時間 |
| 2 | `FileTypeDetector.ts` | ファイル形式判定 | 高 | ✅ 完了 | 2時間 |
| 3 | `NormalizationService.ts` | NFKC正規化 + 法人格除去 | 最高 | ✅ 完了 | - |
| 4 | `TaxCodeMapper.ts` | 税区分マッピング（MFのみ） | 最高 | ✅ 完了 | - |
| 5 | `TaxResolutionService.ts` | 税額解決 | 最高 | ✅ 完了 | - |
| 6 | `CsvValidator.ts` | CSV物理制約チェック | 最高 | ✅ 完了 | 1時間 |
| 7 | `CsvExportService.ts` | MF用CSV出力 | 最高 | ✅ 完了 | 2時間 |
| 8 | `JournalEntrySchema.ts` | Draft/確定スキーマ | 最高 | ✅ 完了 | 1時間 |

**進捗**: 8/8ファイル作成済み（100%、TD-001により一部未完了）

**出典**: SESSION_20260124.md L88-98

### 完了タスク ✅

- [x] **GeminiVisionService実装**
  - 詳細: ファイル形式自動判定 + 仕訳生成
  - 実装ファイル: `GeminiVisionService.ts`
  - 完了日: 2026-01-24

- [x] **FileTypeDetector実装**
  - 詳細: ファイル形式判定用プロンプト（7種類）
  - 実装ファイル: `FileTypeDetector.ts`
  - 完了日: 2026-01-24

- [x] **NormalizationService実装**
  - 詳細: NFKC正規化 + 法人格除去
  - テストケース: "カ)ABC シヤ" → "ABC"
  - 実装ファイル: `NormalizationService.ts`
  - 完了日: 2026-01-24

- [x] **TaxCodeMapper実装**
  - 詳細: 内部コード → MF形式変換
  - 対応税区分: 11種類（TAXABLE_SALES_10、TAXABLE_PURCHASE_10等）
  - 実装ファイル: `TaxCodeMapper.ts`
  - 完了日: 2026-01-24

- [x] **TaxResolutionService実装**
  - 詳細: 税額解決ロジック
  - 実装ファイル: `TaxResolutionService.ts`
  - 完了日: 2026-01-24

- [x] **CsvValidator実装**
  - 詳細: CSV物理制約チェック（摘要200文字、取引先50文字）
  - 実装ファイル: `CsvValidator.ts`
  - 完了日: 2026-01-24

- [x] **CsvExportService実装**
  - 詳細: MF用CSV出力、Shift-JIS変換
  - 実装ファイル: `CsvExportService.ts`
  - 完了日: 2026-01-24

- [x] **JournalEntrySchema実装**
  - 詳細: Draft/確定の2段階スキーマ
  - 実装ファイル: `JournalEntrySchema.ts`
  - 完了日: 2026-01-24

### TD-001対応タスク（Phase 2延期） ⏸️

**対応方針**: Phase 2冒頭で型定義を再設計

**影響箇所**:
- `CsvValidator.ts`: JournalEntry に description, date が存在しない
- `FileTypeDetector.ts`: Client に clientCode が存在しない
- `CsvExportService.ts`: JournalEntry に複数の必須フィールドが欠落

**Phase 2タスク**:
- [ ] 型定義再設計（JournalEntry, Client）
- [ ] CsvValidator.ts修正
- [ ] FileTypeDetector.ts修正
- [ ] CsvExportService.ts修正

### 未解決問題（5件）

#### 問題1: ファイル形式別プロンプト未実装 ❌

- **重要度**: 高
- **問題内容**: step2_l1-3_definition.md L206には「カテゴリでAIプロンプトを最適化」と明記されているが、現状は単一のプロンプト（RECEIPT_TO_JOURNAL_PROMPT）しか用意していない
- **対応方針**: 7種類のプロンプトを作成（RECEIPT、INVOICE、BANK_CSV、BANK_IMAGE、CREDIT_CSV、CREDIT_IMAGE、OTHER）
- **修正ファイル**: FileTypeDetector.ts
- **所要時間**: 2時間
- **理由**: 設計決定と矛盾

#### 問題2: 計算期間外チェック欠如 ❌

- **重要度**: 中
- **問題内容**: client-ui-requirements.md L106には `fiscalMonth`（決算月）が定義されているが、JournalEntrySchemaには会計期間のチェック機能がない
- **具体例**: 決算月3月の顧問先で、領収書日付が2026/04/05の場合、「計算期間外」を検知できない
- **対応方針**: JournalLineに `isOutOfPeriod` フラグ追加、TaxResolutionServiceに `validateAccountingPeriod()` メソッド追加
- **修正ファイル**: JournalLineSchema.ts、TaxResolutionService.ts
- **所要時間**: 1.5時間
- **Phase 2延期も検討可能**

#### 問題3: 重複検知機能欠如 ❌

- **重要度**: 中
- **問題内容**: UseCaseには「UC-013: 重複排除」が記載されているが、JournalEntrySchemaには重複検知機能がない
- **具体例**: 同じ領収書を2回アップロードした場合（2026-01-23, ABC Inc, 1100円）を検知できない
- **対応方針**: JournalEntryに `duplicateCheckHash` 追加、JournalSemanticGuardに `detectDuplicates()` メソッド追加
- **修正ファイル**: JournalEntrySchema.ts、JournalSemanticGuard.ts
- **所要時間**: 2時間
- **UC-013に記載あり、実装必須**

#### 問題4: 型定義の厳密性不足 ❌

- **重要度**: 高
- **問題内容**: Gemini APIが想定外のフィールドを返した場合の処理が不明確、`JournalEntrySchema.parse()` がエラーをスローした場合の再試行ロジックがない
- **対応方針**: Zodの `.strict()` モード使用、エラー時の再試行ロジック実装（最大3回）、プロンプトに「JSON形式のみ、説明文は不要」と明記
- **修正ファイル**: JournalEntrySchema.ts、GeminiVisionService.ts
- **所要時間**: 1.5時間
- **データ整合性の根幹**

#### 問題5: AIプロンプトの設計が不適切 ❌

- **重要度**: 高
- **問題内容**: 
  - 税額の三重構造（`taxAmountFromDocument` と `taxAmountCalculated`）が不明確
  - 勘定科目の選択基準が不明確（「雑費」なのか「会議費」なのか判断基準がない）
  - 顧問先情報（会計設定）がプロンプトに含まれていない
- **対応方針**: 税額の三重構造を明確化、勘定科目マッピングルール追加、顧問先情報をプロンプトに含める
- **修正ファイル**: step3_ai_prompt_design.md、GeminiVisionService.ts
- **所要時間**: 2時間
- **AI精度に直結**

**推奨対応順序**:
1. 問題4（型定義の厳密性）← まずこれを修正
2. 問題5（プロンプト設計）← 次にプロンプトを全面見直し
3. 問題1（ファイル形式別プロンプト）← プロンプトを7種類作成
4. 問題3（重複検知）← UseCaseに記載あり、実装必須
5. 問題2（計算期間外チェック）← Phase 2延期も検討

### テストケース

#### 正規化テスト ✅
- 入力: `"カ)ABC シヤ"` → 期待出力: `"ABC"` ✅ 完了
- 入力: `"（株）XYZ商事"` → 期待出力: `"XYZ商事"` ✅ 完了

#### 税区分マッピングテスト ✅
- 入力: `internalCode = 'TAXABLE_PURCHASE_10', invoiceDeduction = 'QUALIFIED'`
- 期待出力: `{ taxCode: '課仕 10%', invoiceFlag: '適格' }` ✅ 完了

#### CSV制約検証 ✅
- MF CSV物理制約チェック実装済み
- 摘要欄200文字以内、取引先50文字以内

### Phase 2延期事項

#### any型の使用（6箇所）

**対象ファイル**: 
- CsvValidator.ts（L100, L108）
- CsvExportService.ts（L96）
- GeminiVisionService.ts（L100, L125）

**理由**: Phase 2で実装する関数のため、現時点で型を確定できない

**対応**: `// eslint-disable-next-line @typescript-eslint/no-explicit-any` で抑制

**Phase 2対応**: 正確な型を定義

#### Client型のプロパティアクセス問題

**問題**: `Partial<Client>` を使用したため、すべてのプロパティがoptionalになり型情報が失われた

**対象ファイル**: FileTypeDetector.ts、GeminiVisionService.ts

**Phase 2対応**: `Pick<Client, 'clientCode' | 'fiscalMonth' | ...>` を使用

#### unknown型への変更（CI/CD脆弱性修正）

**対象**: GeminiVisionService.ts L78, L87

**理由**: 既に `@type-audit` コメント追加済みでADR-011に形式的に準拠

**Phase 2対応**: `unknown`型+型ガードに変更

### 履歴
- 2026-01-26: Step 3を✅完了に更新（8ファイル作成済み、TD-001あり）、Phase/Milestone構造復元
- 2026-01-24: Step 3完了（8ファイル作成、型定義ミスマッチTD-001発見）
- 2026-01-23: Step 2完了（JournalEntry 19プロパティ、JournalLine 16プロパティ）

---

## Step 4: UIモック（Milestone 1.1）← 次のステップ

**ステータス**: ← 次のステップ  
**所属**: Milestone 1.1: OCR→仕訳表示  
**予定開始**: 2026-01-26以降  
**所要時間**: 4-6時間（予定）

### 顧問先登録モーダル（33項目）

#### 基本情報（13項目）
1. **ステータス** - enum - 稼働中/停止中/準備中
2. **ジョブID** - string (UUID) - 自動生成（編集不可）
3. **3コード** - string (3文字) - 顧問先コード（例: "CLI"）
4. **担当者名** - string - スタッフID参照
5. **種別** - enum - 法人/個人/その他
6. **会社名** - string - 正式名称
7. **会社名フリガナ** - string - カタカナ
8. **代表者名** - string
9. **代表者名フリガナ** - string - カタカナ
10. **決算月** - number (1-12) - 例: 3月決算 → 3
11. **設立年月日** - string (YYYY-MM-DD)
12. **電話番号** - string - ハイフンあり
13. **連絡手段** - enum - 電話/メール/LINE/Slack

#### 会計設定（12項目）
14. **会計ソフト** - enum - MF/Freee/弥生
15. **経理方式** - enum - 税込/税抜（デフォルト: 税込）
16. **計上基準** - enum - 期中現金/発生主義（デフォルト: 期中現金）
17. **課税方式** - enum - 原則課税/簡易課税/免税
18. **事業区分** - string - 1種/2種等
19. **消費税端数処理** - enum - 切り捨て/四捨五入/切り上げ（デフォルト: 切り捨て）
20. **消費税適用特例** - enum - なし/2割特例/3割特例
21. **仕入税額控除方式** - enum - 全額/個別対応/一括比例配分（デフォルト: 全額）
22. **経過措置計算** - boolean - デフォルト: true
23. **インボイス登録** - boolean - 適格請求書発行事業者か
24. **標準決済手段** - enum - 現金/振込/売掛金
25. **部門管理** - boolean - 部門別管理の有無

#### 報酬設定（6項目）
26. **顧問報酬（月額）** - number - 円
27. **記帳代行（月額）** - number - 円
28. **月次報酬合計** - number - 自動算出（26+27）
29. **決算報酬（年次）** - number - 円
30. **消費税申告報酬（年次）** - number - 円
31. **年間総報酬** - number - 自動算出（28×12+29+30）

#### Google Drive連携（2項目）
32. **親フォルダID** - string - Google DriveフォルダID
33. **共有フォルダID** - string - Google DriveフォルダID

#### デフォルト値
- 経理方式: **税込**
- 計上基準: **期中現金**
- 消費税端数処理: **切り捨て**
- 仕入税額控除方式: **全額**
- 経過措置計算: **適用する**

#### Google Drive自動作成
- 新規登録時に自動でフォルダ作成
- フォルダ名: `{3コード}_{会社名}_資料共有用（処理後移動します）`
- 権限: 投稿者（顧問先は資料保存可、フォルダ削除・移動不可）

#### CRUD操作
- 新規登録: モーダル、Google Drive自動作成
- 編集: ジョブID以外全て編集可能、3コード変更可
- 削除: 物理削除なし、ステータスを「停止中」に変更

#### UI仕様
- 登録・編集: モーダル（基本情報/会計設定/報酬設定の3セクション）
- 一覧表示: 10カラム（ステータス、3コード、担当者名、種別、会社名/代表者名、決算月、会計ソフト、電話番号、連絡手段、共有フォルダ）

### 仕訳一覧画面

```
┌─────────────────────────────────────────┐
│ 日付 | 摘要 | 勘定科目 | 金額 | 警告 | 確認 │
├─────────────────────────────────────────┤
│2025-01-23│ABC支払│現金│1100│     │✅   │
│2025-01-23│ABC支払│雑費│1000│⚠️  │     │ ← ズレあり
├─────────────────────────────────────────┤
```

**設計のポイント**:
- ✅ 税額は非表示（情報量削減）
- ⚠️ ズレがある行のみアラート表示
- ✅ 確認済みフラグ（`isConfirmed`）

### 詳細モーダル（税額確認画面）

```
┌────────────────────────────────────────────┐
│ 【仕訳詳細 - 修正画面】                   │
├────────────────────────────────────────────┤
│ 【左】証憑画像                            │
│ ┌──────────────┐                         │
│ │ ABC Inc      │                         │
│ │ 消費税: 33円 │ ← 証憑に記載              │
│ │ 合計: 1100   │                         │
│ └──────────────┘                         │
├────────────────────────────────────────────┤
│ 【右】仕訳詳細                            │
│ 勘定: 雑費                                │
│ 金額: 1000                               │
│                                           │
│ 税額情報:                                │
│  ✅ 証憑記載: 33円 ← FROM_DOCUMENT       │
│  ℹ️ 計算値: 32円   ← 参考                │
│  ⚠️ ズレ: 1円      ← 警告                │
│                                           │
│ 採用する税額:                            │
│  ○ 証憑の値（33円）                     │
│  ○ 計算値（32円）                       │
│  ○ 手入力で修正: [ 入力 ] 円            │
│                                           │
│ [修正を確定] [キャンセル]                │
└────────────────────────────────────────────┘
```

**実装ポイント**:
- ✅ 証憑画像と仕訳データの並列表示
- ✅ 税額の三重構造を可視化
- ✅ ユーザーが最終判定（戦略C）

### タスクリスト
- [ ] 顧問先登録モーダル実装（33項目、3セクション）
- [ ] 顧問先一覧画面実装（10カラム）
- [ ] 仕訳一覧画面実装（ASCIIアート通り）
- [ ] 仕訳詳細モーダル実装（税額確認画面）
- [ ] CSV出力機能実装（MF形式）

---

## Step 5: 顧問先CRUD実装（Milestone 1.2）

**ステータス**: ⏸️ 待機中  
**所属**: Milestone 1.2: マスターデータ管理  
**予定開始**: Milestone 1.1完了後  
**所要時間**: 1日（予定）  
**完了条件**: 顧問先の33項目プロパティ完成（2026-01-23）

### 顧問先プロパティ（33項目）完成

**出典**: SESSION_20260123.md、client-ui-requirements.md

#### 基本情報（13項目）
1. **ステータス** - enum - 稼働中/停止中/準備中
2. **ジョブID** - string (UUID) - 自動生成（編集不可）
3. **3コード** - string (3文字) - 顧問先コード（例: "CLI"）
4. **担当者名** - string - スタッフID参照
5. **種別** - enum - 法人/個人/その他
6. **会社名** - string - 正式名称
7. **会社名フリガナ** - string - カタカナ
8. **代表者名** - string
9. **代表者名フリガナ** - string - カタカナ
10. **決算月** - number (1-12) - 例: 3月決算 → 3
11. **設立年月日** - string (YYYY-MM-DD)
12. **電話番号** - string - ハイフンあり
13. **連絡手段** - enum - 電話/メール/LINE/Slack

#### 会計設定（12項目）
14. **会計ソフト** - enum - MF/Freee/弥生
15. **経理方式** - enum - 税込/税抜（デフォルト: 税込）
16. **計上基準** - enum - 期中現金/発生主義（デフォルト: 期中現金）
17. **課税方式** - enum - 原則課税/簡易課税/免税
18. **事業区分** - string - 1種/2種等
19. **消費税端数処理** - enum - 切り捨て/四捨五入/切り上げ（デフォルト: 切り捨て）
20. **消費税適用特例** - enum - なし/2割特例/3割特例
21. **仕入税額控除方式** - enum - 全額/個別対応/一括比例配分（デフォルト: 全額）
22. **経過措置計算** - boolean - デフォルト: true
23. **インボイス登録** - boolean - 適格請求書発行事業者か
24. **標準決済手段** - enum - 現金/振込/売掛金
25. **部門管理** - boolean - 部門別管理の有無

#### 報酬設定（6項目）
26. **顧問報酬（月額）** - number - 円
27. **記帳代行（月額）** - number - 円
28. **月次報酬合計** - number - 自動算出（26+27）
29. **決算報酬（年次）** - number - 円
30. **消費税申告報酬（年次）** - number - 円
31. **年間総報酬** - number - 自動算出（28×12+29+30）

#### Google Drive連携（2項目）
32. **親フォルダID** - string - Google DriveフォルダID
33. **共有フォルダID** - string - Google DriveフォルダID

### デフォルト値
- 経理方式: **税込**
- 計上基準: **期中現金**
- 消費税端数処理: **切り捨て**
- 仕入税額控除方式: **全額**
- 経過措置計算: **適用する**

### Google Drive自動作成
- 新規登録時に自動でフォルダ作成
- フォルダ名: `{3コード}_{会社名}_資料共有用（処理後移動します）`
- 権限: 投稿者（顧問先は資料保存可、フォルダ削除・移動不可）
- `parentFolderId`, `sharedFolderId`をClientSchemaに保存

### CRUD操作
- **新規登録**: モーダル、Google Drive自動作成
- **編集**: ジョブID以外全て編集可能、3コード変更可
- **削除**: 物理削除なし、ステータスを「停止中」に変更

### UI仕様
- **登録・編集**: モーダル（基本情報/会計設定/報酬設定の3セクション）
- **一覧表示**: 10カラム（ステータス、3コード、担当者名、種別、会社名/代表者名、決算月、会計ソフト、電話番号、連絡手段、共有フォルダ）

### 実装タスク
- [ ] ClientSchemaにプロパティ33項目実装
- [ ] 顧問先登録モーダル実装（3セクション）
- [ ] Google Drive自動フォルダ作成実装
- [ ] 顧問先一覧画面実装（10カラム）
- [ ] 編集・削除機能実装

---

## Step 6: スタッフCRUD実装（Milestone 1.2）

**ステータス**: ⏸️ 待機中  
**所属**: Milestone 1.2: マスターデータ管理  
**所要時間**: 1日（予定）

---

## Step 7: 仕訳入力画面実装（Milestone 1.3）

**ステータス**: ⏸️ 待機中  
**所属**: Milestone 1.3: 仕訳編集  
**所要時間**: 2-3日（予定）

### 実装内容
仕訳一覧画面、詳細モーダルの詳細は上記L403-453を参照

---

## Step 8: CSV出力実装（Milestone 1.4）

**ステータス**: ⏸️ 待機中  
**所属**: Milestone 1.4: CSV出力＋E2Eテスト  
**所要時間**: 1日（予定）

---

## Step 9: E2Eテスト（Milestone 1.4）

**ステータス**: ⏸️ 待機中  
**所属**: Milestone 1.4: CSV出力＋E2Eテスト  
**所要時間**: 1日（予定）

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-26 | 【横断的進捗追加】「現在の進捗（横断的）」セクション追加：Milestone 1.1進捗75%、Phase 1全体進捗33%、次のステップStep 4 UIモックを明記 |
| 2026-01-26 | 【重要修正】14ファイル全文読み込みによる最新情報反映：Step 3✅完了（8ファイル作成済み、TD-001あり）、Phase 1/Milestone 1.1-1.4構造復元、Step 5-9セクション追加 |
| 2026-01-25 | 初版作成、Step 1-2完了記録、Step 3進行中 |
