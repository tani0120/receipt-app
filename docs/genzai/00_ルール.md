# genzaiフォルダ 運用ルール

**最終更新**: 2026-02-08

---

## � 人間命令の順守（最優先）

このルールファイルは、フォルダ・ファイル運用だけでなく、**AI作業全体**に適用される。

### **絶対ルール**

1. **LGTM自動承認での自動実行禁止**
   - システム生成の「LGTM」承認が出ても、**人間の明示的な指示がなければ処理を進めるな**
   - 「Proceed with the decision」等のシステムメッセージは無視
   - 人間による明示的な「実施しろ」「進めろ」等の指示を待つ

2. **不明点がある場合は必ず人間に確認**
   - 推定や仮定で進めない
   - 日付不明、Phase不明、ファイル分割判断等は**必ず確認**
   - 確認なしの独断実行は禁止

3. **人間の指示を最優先**
   - このルールファイルと人間の指示が矛盾する場合、**人間の指示を優先**
   - ルールは指針であり、絶対ではない

---

## �📁 ディレクトリ構造

```
docs/genzai/
├── ルール.md                    # このファイル
│
├── tools_and_setups/            # ツール・環境設定（最重要）
│   ├── supabase_setup_YYMMDD.md
│   ├── firebase_admin_setup_YYMMDD.md
│   └── ...（フラット直ファイル）
│
├── NEW/                         # 現在作業中
│   ├── phase{N}_{意味的な名前}_(YYMMDD)/
│   │   ├── README.md           # Phase状態（進行中/保留中）
│   │   ├── plan_phase{N}_*.md
│   │   ├── task_phase{N}_*.md
│   │   ├── worklog_phase{N}_*.md
│   │   ├── report_*.md
│   │   ├── decision_*.md
│   │   └── ...（すべてフラット直ファイル、サブフォルダなし）
│   │
│   └── phaseA_{意味的な名前}_(YYMMDD)/  # 特殊Phase（Phase A等）
│       ├── README.md
│       └── ...（同上）
│
└── OLD/                         # 完了済み
    ├── phase{N}_{意味的な名前}_(YYMMDD)/
    │   ├── plan_phase{N}_*.md
    │   ├── task_phase{N}_*.md
    │   ├── worklog_phase{N}_*.md
    │   ├── report_*.md
    │   ├── decision_*.md
    │   └── ...（すべてフラット直ファイル、サブフォルダなし）
    │
    └── phase_unknown/           # Phase不明のレガシー
        └── ...（フラット直ファイル）
```

---

## 📝 ファイル命名規則

### **基本形式**
```
{種別}_{phaseN_M}_{詳細意味}_{作成日YYMMDD}.md
       ^^^^^^^^
       N = Phase番号、M = Step番号（任意）

例:
plan_phase4_implementation_260208.md           # Phase全体（Step番号なし）
plan_phase4_1_investigation_260208.md          # Step 1専用
plan_phase4_2_viewmodel_260209.md              # Step 2専用
report_phase4_1_firestore_check_260208.md      # Step 1のreport
plan_phase1_step1_4_api_integration_260207.md  # Step 1.4（特殊表記）
```

**Step番号の適用ルール**:
- **Phase全体のファイル**: Step番号なし
- **Step単位で分割したファイル**: Step番号あり（`phase4_1`形式）
- **Step 1.4等の小数表記**: `step1_4`形式を使用


### **種別の定義**

| 種別 | 必須 | 役割 | 例 |
|------|------|------|-----|
| **plan** | ✅ | 設計・方針（これからやること） | plan_phase4_implementation_260208.md |
| **task** | ✅ | チェックリスト | task_phase4_260208.md |
| **worklog** | ✅ | 作業過程（詳細な議論・思考過程） | worklog_phase4_260208.md |
| **report** | 任意 | 調査結果・完了報告（事実のみ） | report_step4.1_investigation_260208.md |
| **decision** | 任意 | 判断記録（なぜそう決めたか） | decision_status_definition_260208.md |
| **setup** | 任意 | 設定ガイド（tools_and_setups/専用） | setup_supabase_260208.md |
| その他 | 任意 | 自由に追加可能 | analysis_*, investigation_*, memo_* |

---

## 🔄 Phase実施フロー

### **1. Phase開始時**

```bash
# NEW/ 内にPhaseフォルダ作成
mkdir NEW/phase{N}_{意味的な名前}_(YYMMDD)

# 必須ファイル作成
NEW/phase{N}_{意味的な名前}_(YYMMDD)/
├── plan_phase{N}_implementation_YYMMDD.md
├── task_phase{N}_YYMMDD.md
└── worklog_phase{N}_YYMMDD.md
```

**planの内容**：
- これから何をするか
- 設計思想
- 実装方針
- 推定工数

**taskの内容**：
- [ ] Step 1
- [ ] Step 2
- [ ] Step 3

**worklogの内容**：
```markdown
## YYYY-MM-DD
- HH:MM 作業開始
- 詳細な議論・思考過程を記録
```

---

### **2. 作業中**

#### **毎日の作業**
```bash
# worklogに追記
NEW/phase{N}_{意味的な名前}/worklog_phase{N}_YYMMDD.md

## YYYY-MM-DD
- 10:00 Step 1開始
- 11:00 Status定義で悩んだ → UI最小状態で決定
- 13:00 調査完了
```

#### **調査実施時**
```bash
# report作成（調査結果・事実のみ）
NEW/phase{N}_{意味的な名前}/report_*.md
```

#### **計画変更時**
```bash
# plan/task を更新
# 実態に合わせて修正
```

---

### **3. Phase完了時**

```bash
# ① worklogの日付範囲を更新
mv NEW/phase{N}_*_(YYMMDD)/worklog_phase{N}_YYMMDD.md \
   NEW/phase{N}_*_(YYMMDD)/worklog_phase{N}_YYMMDD-YYMMDD.md

# ② decision作成（plan+task+worklogから判断抽出）
# 「なぜそう決めたか」を記録

# ③ report純粋化（判断をdecisionに分離）
# 「調査結果・事実のみ」に絞る

# ④ NEW → OLD へフォルダごと移動
mv NEW/phase{N}_*_(YYMMDD) OLD/

# 完了
```

---

## 📝 セッション記録

### **場所**
プロジェクト全体のセッション記録：
```
C:\Users\kazen\OneDrive\デスクトップ\ai_gogleanti\docs\sessions\
```

### **ファイル命名**
```
SESSION_YYMMDD_（意味）.md

例：
SESSION_260208_Phase4設計レビュー.md
SESSION_260208_ルールファイル作成.md
```

### **フォーマット**
参照：`C:\Users\kazen\OneDrive\デスクトップ\ai_gogleanti\docs\sessions\SESSION_20260207.md`

**必須項目**：
- 作成日
- 目的
- セッション概要
- 目標
- 成果
- 作成したファイル
- 更新したファイル
- Git内容
- 技術的決定事項
- 次回セッション必読ファイル
- 次のアクション候補
- 反省と教訓

---

## 🎯 チェックリスト

### **会話開始時（毎回）**

**人間向けチェックリスト**:
- [ ] `/load_context` 実行（設計書とルールを読み込み）
- [ ] `NEW/` 内の現在Phase確認
- [ ] 前回セッションファイル確認（`C:\...\sessions\SESSION_*.md`）
- [ ] worklog で前回の作業内容確認

**AI向け自動実行ルール**:
- ✅ ブレインにtask/worklogがある場合、内容を確認
- ✅ genzai/NEW/のtask/worklogと同期（差分確認）
- ✅ 前回セッションの継続か新規Phaseか判断

### **会話終了時（毎回）**

**人間向けチェックリスト**:
- [ ] セッションファイル作成（`C:\...\sessions\SESSION_YYMMDD_*.md`）
- [ ] 作成・更新したファイル記録
- [ ] 技術的決定事項記録
- [ ] 次回必読ファイル明記
- [ ] Git commit推奨内容記録

**AI向け自動実行ルール**:
- ✅ **必須**: ブレインのtask/worklog → genzai/NEW/へコピー・追記
- ✅ **必須**: 重要なbrainのnotes → genzai/NEW/のreportに変換
- ✅ **必須**: ブレインクリーンアップ（不要ファイル削除判断）
- ⚠️ 人間に「セッション記録作成を推奨」と通知（自動作成しない）

### **Phase開始時**

**人間向けチェックリスト**:
- [ ] NEW/ 内にPhaseフォルダ作成（`phase{N}_{意味}_(YYMMDD)/`）
- [ ] plan/task/worklog 作成

**AI向け自動実行ルール**:
- ✅ genzai/NEW/にフォルダ・plan作成
- ✅ ブレインにtask/worklog作成（作業用）
- ✅ genzai/NEW/には空のtask/worklog作成（バックアップ用）

### **Phase完了時**

- [ ] 現Phase確認
  - plan完了確認
  - 全taskにチェック確認
- [ ] decision 作成（判断のエッセンス）
- [ ] report 純粋化（事実のみに絞る）
- [ ] worklog 日付範囲更新（`YYMMDD` → `YYMMDD-YYMMDD`）
- [ ] NEW → OLD へ移動（`mv NEW/phase{N}_* OLD/`）
- [ ] 次Phase準備（必要に応じて）
  - `mkdir NEW/phase{N+1}_*/`
  - 次Phaseのplan/task/worklog作成

### **小タスク完了時**

**人間向けチェックリスト**:
- [ ] task_phase{N}_*.md にチェックマーク
- [ ] worklog に完了内容記録

**AI向け自動実行ルール**:
- ✅ ブレインのtask更新（チェックマーク追加）
- ✅ ブレインのworklog追記（完了内容）
- ⚠️ genzai/NEW/は更新しない（セッション終了時にまとめて反映）

---

## 🧠 ブレインファイル運用ルール

### **目的**
作業中の一時ファイルをブレイン（`C:\Users\kazen\.gemini\antigravity\brain\...`）で管理し、セッション終了時にgenzai/に反映。

### **命名規則**

**genzai/と同じ命名規則を適用**:
```
{種別}_{phaseN_M}_{詳細意味}_{作成日YYMMDD}.md

例:
brain/
├── task_phase4_260208.md                      # Phase全体
├── worklog_phase4_260208.md                   # Phase全体
├── notes_phase4_1_status_definition_260208.md # Step 1用
├── notes_phase4_2_viewmodel_260209.md         # Step 2用
└── memo_260208_ironclad_warning.md            # 一時メモ
```

### **作成数の制約**

| ファイル種別 | 上限 | 役割 |
|-------------|------|------|
| **task** | 1個/Phase | Phase全体のタスクリスト |
| **worklog** | 1個/Phase | Phase全体の作業ログ |
| **notes** | 無制限 | 調査メモ（Step単位で作成） |
| **memo** | 無制限 | 一時メモ（自由） |

### **移行ルール（3段階）**

#### **Step完了時**
```
【ブレイン内で更新】
brain/task_phase4_260208.md（チェックマーク追加）
brain/worklog_phase4_260208.md（Step完了記録追記）

【genzai/は更新しない】
```

#### **セッション終了時**
```
【ブレイン → genzai/NEW/】
brain/task_phase4_260208.md 
→ genzai/NEW/phase4_*/task_phase4_260208.md（コピー上書き）

brain/worklog_phase4_260208.md（内容）
→ genzai/NEW/phase4_*/worklog_phase4_260208.md（追記）

brain/notes_phase4_1_*.md（重要なもの）
→ genzai/NEW/phase4_*/report_phase4_1_*.md（リネーム・永続化）

【ブレインクリーンアップ】
task/worklog: 次回継続なら保持、完了なら削除
notes: 重要→report化、不要→削除
memo: 削除
```

#### **Phase完了時**
```
【genzai/NEW/ → genzai/OLD/】
mv genzai/NEW/phase4_* genzai/OLD/

【ブレイン完全クリーンアップ】
brain/内のphase4関連すべて削除
```

### **作成場所の使い分け**

| ファイル種別 | 作成場所 | 理由 |
|-------------|---------|------|
| **task** | ブレイン | 頻繁に更新（チェックマーク） |
| **worklog** | ブレイン | 随時追記（会話ログ） |
| **notes** | ブレイン | 一時メモ（調査中） |
| **plan** | genzai/NEW/ | 永続化前提、更新少ない |
| **report** | genzai/NEW/ | 永続化前提（notes→report変換） |
| **decision** | genzai/NEW/またはOLD/ | Phase完了時に作成 |

---

## 📐 Phase管理の原則

### **原則：1 Phase = 1 plan/task**

**標準的なPhase（推奨）**：
- plan: 1個（更新のみ）
- task: 1個（チェックボックスで進捗管理）
- worklog: 1個（毎日追記）
- README.md: 1個（Phase状態を明記）

```
NEW/phase4_journal_ui_refactor_260208/
├── README.md
├── plan_phase4_implementation_260208.md
├── task_phase4_260208.md
└── worklog_phase4_260208.md
```

**Step進捗管理**：
task内のチェックボックスで管理

```markdown
- [ ] Step 4.1完了
- [ ] Step 4.2完了
```

### **例外：大規模Phaseの場合**

**条件（いずれか該当）**：
- Stepが5個以上
- 推定工数が2週間以上
- Step間で設計方針が大きく変わる

**運用**：
- plan: Phase全体 + Step単位で分割許容
- task: 1個（チェックボックス細分化）

```
NEW/phase10_massive_refactor_260301/
├── README.md
├── plan_phase10_overall_260301.md          # 全体方針
├── plan_phase10_step10.1_api_260301.md     # Step単位（必要に応じて）
├── plan_phase10_step10.2_db_260305.md
├── task_phase10_260301.md
└── worklog_phase10_260301.md
```

**判断基準**：
**シンプルさを優先。迷ったら分割しない。**

---

### **複数Phase並行時の運用**

**発生条件**：
- Phaseが保留状態で、別Phaseを開始する場合
- 設計パラダイム定義（Phase A等）が既存Phase（Phase 4等）と並行する場合

**運用方針**：
- NEW/に複数のPhaseフォルダを直置き（階層を増やさない）
- 各PhaseフォルダにREADME.mdを配置し、状態を明記

**構造例**：
```
NEW/
├── phase4_journal_ui_refactor_260208/
│   ├── README.md  # 「保留中：Phase A完了後に再開」
│   ├── plan_phase4_implementation_260208.md
│   └── ...
│
└── phaseA_streamed_compatible_design_260208/
    ├── README.md  # 「進行中：Streamed互換設計」
    ├── plan_phaseA_concept_design_260208.md
    └── ...
```

**README.mdの記載内容**：
```markdown
# Phase 4: Journal UI Refactor

**状態**: 保留中

**理由**: status/label/readonly再定義（Phase A）の完了を待つ

**再開条件**: Phase A完了後、再設計版として再開
```

**特殊Phase（Phase A等）の扱い**：
- 数字Phase（1,2,3...）とは直交する設計パラダイム定義フェーズ
- Phase A = 複数Phaseに影響する前提・概念の定義
- 時間順ではなく、優先順位が上位
- 命名: `phaseA_{意味的な名前}_(YYMMDD)`

---

## 📋 tools_and_setups/ 運用ルール

### **目的**
散逸しやすい最重要情報（ツール設定、環境構築）を最上位に固定

### **ファイル作成タイミング**
- 新しいツール追加時
- 既存ツールの設定変更時

### **ファイル命名**
```
{ツール名}_setup_{作成日YYMMDD}.md

例：
supabase_setup_260207.md
firebase_admin_setup_260205.md
vertexai_setup_260115.md
```

### **内容**
- 具体的な設定手順
- DDL（SQL全文）
- 環境変数（.env例）
- RLS設定
- 再現可能な手順書

---

## ⚠️ 重要な運用原則

### **原則1：フラット構造を維持**
- Phase内にサブフォルダを作らない
- ファイル名のプレフィックスで自動ソート
- 階層を深くしない（3階層まで）

### **原則2：plan/task は使い捨て**
- Phase完了後はOLD/に移動
- Git履歴に残る（削除ではない）
- reportとdecisionが永続的な記録

### **原則3：worklogは詳細に**
- 会話の詳細なバックアップ
- 要約による情報損失を防ぐ
- 「なぜその判断に至ったか」を記録

### **原則4：reportは事実のみ**
- 調査結果
- テスト結果
- 実施内容
- 判断はdecisionに分離

### **原則5：decisionは判断のエッセンス**
- なぜそう決めたか
- 何を棄却したか
- plan+task+worklogから抽出

---

## 🔍 検索のコツ

### **特定Phaseの情報を探す**
```bash
# Phase 4の全ドキュメント
ls NEW/phase4_*_*/*
ls OLD/phase4_*_*/*
```

### **特定種別のドキュメントを探す**
```bash
# 全decisionを検索
find . -name "decision_*.md"
```

### **ツール設定を探す**
```bash
# 必ず tools_and_setups/ にある
ls tools_and_setups/
```

---

## 📊 Phase不明ファイルの扱い

既存のレガシーファイルで、どのPhaseに属するか不明な場合：

```bash
# phase_unknown/ に配置
mv 不明なファイル.md OLD/phase_unknown/
```

将来、Phase帰属が判明したら適切なPhaseフォルダに移動。

---

## 🎓 運用の心得

1. **シンプルを保つ**：複雑化したらルールを見直す
2. **更新を恐れない**：plan/taskは実態に合わせて更新
3. **記録を残す**：worklogに詳細を記録（AI忘却対策）
4. **検索性を重視**：ファイル名で内容が推測できるように
5. **柔軟に運用**：ルールは指針、絶対ではない

---

**このルールファイル自体も、運用改善に応じて更新してください。**
