# Phase A: Streamed互換・設計パラダイム定義 概要

**作成日**: 2026-02-08  
**バージョン**: v1.0  
**対象読者**: 本人、将来の自分、Phase 4再開時の参照、外部レビュワー（AI）

---

## 【序文】この定義に至った経緯

### なぜ「設計パラダイム定義」が必要だったか

Phase 4実装中、複数の問題が顕在化した：

1. **UI真っ白問題**: statusベースUIの意味論が不明確
2. **optional地獄**: 242個のoptionalフィールド（Firestore起因）
3. **監査証跡の欠如**: 履歴管理の設計不在

根本原因は「Streamed互換とは何か」が定義されていなかったこと。Phase 4の実装を進める前に、Phase Aで設計前提を確立する必要があった。

詳細な技術検討は [ChatGPT議論ログ: PostgreSQL移行とStreamed互換設計](file:///c:/dev/receipt-app/docs/genzai/NEW/phaseA_streamed_compatible_design_260208/discussion_chatgpt_postgresql_migration_260209.md) を参照。

---

### 価値定義の試行錯誤（5つの試み）

Phase A開始時、「実現したい価値」の定義が抽象的で実務要件との接続が見えなかった。具体的な機能要件から根源的な価値を抽出する議論を実施（2026-02-09）。

#### 試み1: 「人間が統治し、判断根拠を提示」
→ **問題**: 抽象的すぎる。実務要件との関係が不明。

#### 試み2: 「仕訳作業からの解放」
→ **問題**: 普遍的価値。すべての仕訳システムが同じ。差別化が見えない。

#### 試み3: 「説明責任の効率化」
→ **重要な発見①**: 説明責任はシステムで実現できない。提供できるのは「説明材料（fact）」のみ。

#### 試み4: ルールの精緻化
→ **重要な発見②**: ルールの二層構造
- **会計ルール**（普遍的）: 10万円/30万円の区切り等
- **仕訳ルール**（顧問先固有）: Aクレカ→消耗費等

→ **重要な発見③**: ベテランの暗黙知
- 判断する価値がある仕訳はほとんどない
- ベテランは仕訳ルールを内在化→直感で判断
- システム化＝暗黙知の明示化

#### 試み5: AI推測の逆説
→ **重要な発見④**: 同じゴール、違う手段、真逆の結果

| 観点 | 他のAI仕訳システム | Streamed互換 |
|------|-------------------|-------------|
| **ゴール** | 選択するだけで完了 | 選択するだけで完了 |
| **手段** | AI推測・自動化 | ルール明示化 |
| **結果** | 責任曖昧、変更不明、理由不明 | 責任明確、変更通知、理由提示 |

---

### 最終定義

**「システムの設計やルールの在り方でAIに責任を持たせず、変更や理由を人間が制御し、ただ選択するだけで仕訳を完了できる補助システム」**

この定義が、以降のすべてのセクションの基盤となる。

詳細な議論過程は [価値定義の議論ログ](file:///C:/Users/kazen/.gemini/antigravity/brain/b317fb3f-1c5a-46ab-9b80-d50923f2ae26/discussion_phaseA_value_definition_260209.md) を参照。

---

## 【前文】実現したい価値

### 誰に

税理士・会計士・経理担当者

### 何を

**「システムの設計やルールの在り方でAIに責任を持たせず、変更や理由を人間が制御し、ただ選択するだけで仕訳を完了できる補助システム」**

**この定義の意味**:
- **「システムの設計やルールの在り方で」**: 技術的手段を明示
- **「AIに責任を持たせず」**: AI推測・自動化との差別化
- **「変更や理由を人間が制御し」**: 統治権の明示
- **「ただ選択するだけで仕訳を完了できる」**: ゴール（時間最小化）

**導出過程**: [価値定義の議論ログ](file:///C:/Users/kazen/.gemini/antigravity/brain/b317fb3f-1c5a-46ab-9b80-d50923f2ae26/discussion_phaseA_value_definition_260209.md)

---

### 価値の3階層

#### **レイヤー1: ビジネス的な価値（最上位）**

**税理士・会計士が本当に欲しいもの**:
- ❌ 「速い仕訳」
- ❌ 「賢いAI」
- ✅ **「説明責任を果たせる仕組み」**

**実現したい状態**:
- **黙って変わらない**（予測可能）
- **理由が分かる**（説明可能）
- **後から戻せる**（巻き戻し可能）

**結果**:
- 税理士が安心して自動化を「使い続けられる」
- 事故が起きても「責任の所在が明確」
- 監査・税務調査で「説明できる」

#### **レイヤー2: 機能的な価値**

**提供する機能**:
1. **止める設計**
   - 自動化OFF（全体・期間・ルール単位）
   - ONよりOFFが大きい
   
2. **説明できる設計**
   - なぜこの仕訳になったか
   - どのルールが使われたか
   - いつから有効か
   
3. **巻き戻せる設計**
   - 仕訳は上書きしない（履歴を積む）
   - 1仕訳だけ / ルール起点で / 期間単位で戻せる

4. **選択するだけで仕訳完了**
   - ルールベース: 顧問先ローカルルールで反復取引に対応（85-90%）
   - 過去仕訳CSV: 新規顧問先でも選択肢提示（fact基盤）
   - AI推論: 初めての取引のみ（確度低表示）
   
**実現率**:
- 反復継続的な取引: 85-90%が選択だけで完了
- 新規/イレギュラー: AI推論を選択肢として提示（人間が選択拒否可能）

#### **レイヤー3: 技術的な価値（手段）**

**技術で実現すること**:
- GA + AI 正規化（コスト削減）
- ルール劣化検知（自動化の安全性）
- 顧問先ローカルルール（精度向上）

→ これらは**手段**であり、価値の本質ではない

---

### 一言でいうと

**「統制可能性を保証する設計」**

- 税理士が避けたいこと = 「黙って変わる、理由が分からない、後から戻せない」
- Streamed互換の価値 = 完全な統制可能性と説明可能性

---

## 【前文】Streamed互換の哲学：なぜ「人間の統治権を保証する設計」なのか

### Streamedの本質

**Streamedの本質は**:
- AIでもOCRでもなく、**「人を怖がらせない設計」**

### 価値の源泉

**価値の源泉は**:
- 精度ではなく、**止まり方・戻り方・説明のされ方**

### 学習の正体

**学習の正体は**:
- モデル学習ではなく、**責任を持てるルール化**

### UXの主役

**UXの主役は**:
- 仕訳画面ではなく、**「管理・制御・ログ」**

---

### 税理士が一番嫌うこと

税理士・会計士が一番嫌うのは👇

1. **黙って変わる**
2. **理由が分からない**
3. **後から戻せない**

この設計は、全部その逆をやる:

- 🔍 **なぜそうなったかが見える**
- 🛑 **いつでも止められる**
- ↩️ **責任単位で巻き戻せる**
- 🧾 **説明用ログが自然に残る**

だから、**「賢いAI」ではなく「安心できる仕組み」**になる。

---

### Streamedが強い理由（内部思想）

**Streamedが強い理由は**:
- 技術力ではなく、**恐怖の回避がうまい**

**具体的には**:
- 自動化率を自慢しない
- 学習を前面に出さない
- 判断主体を自分だと言わない
- 全部、**「怒られないため」の設計**

**この設計思想がもたらすもの**:
- 精度を追ってない → **間違ったときにすぐ気づけるか**を追っている
- 学習は武器ではなく爆弾 → 変化 = 再現不能 = 会計では致命的
- 一番大事なのは怒られないこと → 驚かせない、勝手にやらない、黙って壊れない

---

### この設計が税理士に刺さる理由

**なぜこの設計が税理士に刺さるか**:

税理士・会計士が求めているのは「速さ」ではなく**「コントロール」**。

Streamed互換の設計は、その恐怖回避ロジックを**構造として再発明**している。

---

## 0. このドキュメントの位置づけ

### Phase Aの目的

Phase Aは**「設計を書く前の設計」**を行うフェーズである。

Phase 4（Journal UI Refactor）の実装中、status/label/readonlyの意味論に違和感が発生した。この違和感は単なる実装の問題ではなく、**設計の前提そのものが揺らいでいる**サインであった。

Phase Aでは、以下を確定させる:
- **思想**: なぜStreamed互換なのか
- **価値**: 税理士・会計士にとって何が安心なのか
- **前提条件**: status/label/readonlyの意味、AIの位置づけ、やらないこと

### なぜ「概要」が必要か

実装（Phase 4）と設計思想（Phase A）が並行する状態は、通常は避けるべきである。しかし今回は:
- Phase 4の一部（Step 4.1-4.3）は既に完了しており、巻き戻しは非効率
- 違和感の正体が「設計思想の欠如」であることが判明
- Phase 4を保留し、Phase Aで前提を固定してから再開する方が安全

Phase Aの概要ドキュメントは、Phase 4再開時の「羅針盤」となる。

### Phase 4との関係

Phase 4は「保留中」であり、「失敗」ではない。

Phase 4で完了した部分:
- Step 4.1: 型システム基盤構築 ✅
- Step 4.2: ViewModel実装 ✅

- Step 4.3.11: 明細入力7項目のdisabled制御 ⏸

Phase Aが確定した後、Phase 4は**再設計版として再開**する。

---

## 1. なぜ「Streamed互換」なのか

### Phase 4で発生した違和感

実装中に以下の疑問が浮上した:

1. **remanded（差戻し）の概念が実態と合わない**
   - 想定: 「上席が修正指示」（レビュー差戻し型フロー）
   - 実態: 「判断に必要な情報が足りない」（判断保留）

2. **readonlyの発生条件が曖昧**
   - 当初: Submitted / Approved で readonly
   - 再考: 承認後のみ readonly が自然

3. **Streamed互換の必要性**
   - イベント駆動 × 状態タグ の設計が必要
   - statusは「結果」ではなく「途中経過」

これらは単なる「実装の揺れ」ではなく、**設計思想の不在**を示している。

### 「再現」vs「互換」の違い

**再現とは**:
- MF Streamedの内部ロジックを「そのまま」作ること
- 判断ロジック、精度の出方、失敗の仕方、人に回る条件、価格構造すべてを同じにする
- → **事実上不可能**（10年以上の修正履歴、数百万件の人手修正ログ、非公開の会計例外ルール、業種・税制改正ごとの分岐、顧客ごとの癖）

**互換とは**:
- MF Streamedの「外から見た振る舞い」を同じにすること
- 入力・出力・振る舞いが同じであれば、内部ロジックは違ってよい
- → **現実的**

**互換の定義**:

| 要素 | 同じにすべきもの |
|------|-----------------|
| **入力** | 領収書画像、バッチ単位、会計期間・事業者設定 |
| **出力** | 複合仕訳JSON、貸借一致、確信度・要確認フラグ、重複・期間外フラグ |
| **振る舞い** | 自動で通るものは通る、怪しいものは止まる、人が見るポイントが同じ |

**Streamed互換を選ぶ理由**:
- 15円/枚制約に最適化できる
- 業務要件に合わせて変えられる
- 税制改正に耐える
- 設計意図が自分で理解できる

**Streamedの価値の正体**:
- 「正解を出すこと」ではなく、**「間違えないところで止まること」**

---

## 2. Streamed互換の定義

### 何が同じで、何が違ってよいのか

**同じにすべきもの（互換の核心）**:
1. 貸借一致は絶対
2. 複合仕訳を自然に出す
3. 確信度で止まる
4. 人が直しやすい
5. 勝手に推測しない

**違ってよいもの（内部ロジック）**:
1. OCRベンダー
2. モデルの種類
3. 学習アルゴリズムの詳細
4. UIの見た目

### 入力・出力・振る舞いの互換

**入力の互換**:
- 領収書画像（JPEG/PNG/PDF）
- バッチ単位（複数枚同時処理）
- 会計期間・事業者設定

**出力の互換**:
- 複合仕訳JSON（MF/freee API互換）
- 貸借一致保証
- 確信度スコア（0.0-1.0）
- 要確認フラグ（NEEDS_INFO等）
- 重複検知フラグ
- 期間外フラグ

**振る舞いの互換**:
- 自動確定できるものは自動確定（上限85%）
- 境界線上のものは必ず人に返す
- エラー理由が一行で分かる
- 人が直した瞬間に「今後どうするか」を聞く

---

## 3. AIの位置づけ

### AIがやらないこと（最重要）

**会計判断をしない**:
- 貸借一致 → 数式で100%解ける（AI不要）
- 税率・期間判定 → 法令ルール（AI推測禁止）
- ルール適用可否 → 再現性・説明性が必要（AI不要）

**AIをこの領域に入れると事故る**。

### AIがやること

**① あいまい一致（人が感覚でやってる部分）**:
- 店名表記ゆれ（ENEOS / エネオス / ENEOS㈱○○SS）
- 摘要の自然文
- 役割: ベクトル化、類似度、正規化候補提示
- 重要: ルール生成の「前段」のみ

**② ルール候補の提案（決定は人）**:
- 人が2回同じ仕訳をしたとき、AIが提案: 「この条件、次から自動にしますか？」
- 決定権は人

**③ 「怪しさ」の説明（安心感）**:
- なぜ止めたか（合計金額と明細合算が一致しません）
- どこが怪しいか（軽減税率と10%が混在しています）
- 人が見るべき点
- 人の確認時間が激減

**AIは"例外処理装置"であり、主処理系ではない**（AI暴走防止）。

---

## 4. このシステムが「やらないこと」

**① 勝手に確定しない**:
- 自動候補は必ず理由を表示
- どのルールが使われたかを明示
- いつから有効かを表示

**② 想像で補完しない**:
- 金額が読めない → 止める（推測しない）
- 税率が不明 → 止める（デフォルト適用しない）
- 取引先が曖昧 → 止める（最も近いものを選ばない）

**③ グローバル学習しない**:
- 顧問先Aの学習を顧問先Bに流用しない
- ルールは顧問先スコープ限定
- いつでも無効化可能

**④ 自動化率を競わない**:
- 自動確定上限は85%（ハード制限）
- 残り15%は必ず人が見る
- 精度より安全性を優先

---

## 5. 税理士・会計士にとっての価値

### 何が「安心」なのか

税理士・会計士は「速さ」より**「コントロール」**を欲しがる。

**安心の3要素**:

**① 止める設計**:
- 自動仕訳OFF（全体）
- 今月だけOFF（期間限定）
- このルールだけOFF（ルール単位）
- ONよりOFFが大きい

**② 説明できる設計**:
- なぜこの仕訳になったか（ルールID表示）
- どのルールが使われたか（作成日時表示）
- いつから有効か（適用開始日表示）
- ブラックボックス感を消す

**③ 巻き戻せる設計**:
- 仕訳は上書きしない（履歴を積む）
- 修正が起きたら version 1 (auto) → version 2 (human)
- 1仕訳だけ戻す / ルール起点で戻す / 期間巻き戻し

**Streamedが絶対に公開しない内部思想**:
- 精度を追ってない → **間違ったときにすぐ気づけるか**を追っている
- 学習は武器ではなく爆弾 → 変化 = 再現不能 = 会計では致命的
- 一番大事なのは怒られないこと → 驚かせない、勝手にやらない、黙って壊れない

---

## 6. UIイメージ（体験）

### UXの3原則

**① 自動 = 勝手に確定しない**:
- ✔ 自動候補（ENEOSルール / 2025-11-作成）
- ブラックボックス感を消す

**② 「直したら終わり」にならない**:
- 税理士が直した瞬間に表示:  
  「この修正を今後の候補に反映しますか？ [はい] [今回はしない]」
- 学習ではない → 意思表示のUI

**③ 止めるUIが一番目立つ**:
- 自動仕訳OFF（大きいボタン）
- 今月だけOFF（中くらい）
- ONボタン（小さい）
- OFFがONより目立つ

### 税理士が喜ぶ画面トップ3

1. ルール一覧（編集・凍結できる）
2. 自動→人修正ランキング
3. 今月の自動化率（上限付き）

Streamedは「仕訳画面より、管理画面が強い」。

---

## 7. 設計への翻訳メモ

### status の再定義

**従来の誤解**: statusは「進捗」

**正しい理解**: statusは「判断可能性」

| status | 意味 | 判断可能性 |
|--------|------|----------|
| DRAFT | 下書き | 判断材料なし |
| SUBMITTED | 提出済み | 判断待ち |
| NEEDS_INFO | 判断保留 | 情報不足により判断不可 |
| APPROVED | 承認済み | 判断完了（不可逆） |

**remandedを削除した理由**:
- 「差戻し」は「上席が修正指示」を想起させる
- 実態は「判断に必要な情報が足りない」
- NEEDS_INFOに置換

### label の役割

**label = 注意喚起、判断保留理由**

statusとは独立したタグ（複数値可能）

例:
- `MULTI_TAX`（軽減税率と10%が混在）
- `LOW_OCR_CONF`（OCR信頼度が低い）
- `OUT_OF_PERIOD`（期間外）
- `DUPLICATE_SUSPECT`（重複の疑い）

labelはUI表示に使う（赤いバッジ、警告アイコン等）。

### readonly の意味

**従来の誤解**: Submitted / Approved で readonly

**正しい理解**: readonly は「責任確定」

| status | readonly |
|--------|----------|
| DRAFT | false |
| SUBMITTED | false（まだ判断前） |
| NEEDS_INFO | false（判断保留中） |
| APPROVED | **true**（判断完了・不可逆） |

**readonly = 承認後のみ**。

---

## 8. 学習ロジック詳細

### 学習の正体

**多くの人の誤解**:
- AIモデルを学習している
- 仕訳を覚えて賢くなっている

**実態**:
- Streamedの学習の大部分は「AIモデルの学習」ではなく、**「ルール・制約・優先順位の更新」**

学習とは:
- **モデルを賢くする**のではなく、**止める条件を賢くする**

### 学習の種（3種類）

Streamed互換では、学習の種は3系統しかない。

**① 制約で「止まった」ログ（最重要）**:
```json
{
  "receipt_id": "...",
  "state": "CONSTRAINT_FAILED",
  "fail_reasons": ["MULTI_AMOUNT", "TAX_MISMATCH"]
}
```
- ルールが厳しすぎる or 足りない
- 次回以降の「止め方」を調整できる
- **正解を知らなくても学習できる**

**② 人が「直した」ログ**:
```json
{
  "auto_candidate": {
    "account": "通信費",
    "tax": "10%"
  },
  "human_fix": {
    "account": "消耗品費",
    "tax": "非課税"
  }
}
```
- この条件では自動確定NG
- confidence閾値を上げる
- anomalyを追加
- **正解を覚える必要はない（「この条件では危険」だけ記録）**

**③ 自動確定「できた」ログ（見落とされがち）**:
```json
{
  "auto_committed": true,
  "anomaly_score": 0.1
}
```
- 問題が起きなかったケースは安全領域の証明
- ここが溜まるほど自動化率が上げられる

### 顧問先ローカルルール


**概要**: 同一条件で人が**2回連続**で同じ仕訳をしたら、ルール候補に昇格

**メリット**:
- 誤仕訳の統計的排除（1回目が間違いでも2回目で検証）
- システムの「学習」感が出る

**デメリット**:
- ブラックボックス化（「なぜ1回目は登録できない？」が見えない）
- UX的違和感（何回目かを意識させる）
- 効率低下（2回目までルール化されない）

**価値定義との照合**:
- ⚠️ 「変更や理由を人間が制御」に反する可能性（暗黙的判断）

---

#### 1回案（Streamed実態 + 明示的制御）【採用】

**概要**: 人が1回仕訳を確定したら、次回同じ条件の取引でルールとし て提示。**ルール化・例外化は人間が明示的に選択**。

**UI例**:
```
仕訳完了！次回この条件の取引を：
[ ルール化する（次回自動提示）]
[ 例外として扱う（毎回確認）]
```

または：
```
[ 確定 ] [ 確定して例外化 ]
```

**メリット**:
- 透明性（なぜルール化されるか・されないかが明確）
- 人間制御（毎回明示的に選択）
- 効率（1回目からルール化可能）
- 安心感（「なぜそうなったか見れる」）

**デメリット**:
- 誤仕訳が1回でルール化されるリスク（ただし明示的確認で軽減）

**価値定義との照合**:
- ✅ 「AIに責任を持たせず」: ルール化の判断は人間
- ✅ 「変更や理由を人間が制御」: 明示的選択UI
- ✅ 「ただ選択するだけで仕訳を完了」: 2回目以降は選択だけ

---

**採用理由**: 価値定義「変更や理由を人間が制御」を最も体現。Streamed思想「人を怖がらせない設計」に合致。

**設計根拠の詳細**: [verification_A04_comparison.md](file:///C:/Users/kazen/.gemini/antigravity/brain/b317fb3f-1c5a-46ab-9b80-d50923f2ae26/verification_A04_comparison.md)

---

### ルール構造例

```json
{
  "client_id": "A",
  "vendor_pattern": "ENEOS",
  "amount_range": [3000, 15000],
  "account": "旅費交通費",
  "sub_account": "ガソリン代",
  "description": "給油",
  "confidence": 0.98,
  "auto_commit": false,
  "rule_status": "ACTIVE",
  "created_by": "human",
  "created_at": "2026-02-09"
}
```

**ルール生成時の注意**:
- `auto_commit: false` → 即自動確定させない（提案のみ）
- `created_by: "human"` → 人間が明示的に作成したことを記録

### 閾値更新アルゴリズム

**更新対象**:

| 項目 | 学習対象 |
|------|----------|
| LLMモデル | ❌ |
| OCRモデル | ❌ |
| confidence閾値 | ⭕ |
| anomaly重み | ⭕ |
| 制約優先順位 | ⭕ |
| auto_commit条件 | ⭕ |

**全部「数値とルール」**。

**具体例**:
- 修正が多い条件（vendor=Amazon、amount>50,000、複数税率）  
  → auto_commit禁止、anomaly_score +0.3
- 問題が出ない条件（vendor=ENEOS、単一金額、10%）  
  → auto_commit閾値↓、LLMスキップ

---

## 9. ルール劣化・破棄ロジック詳細

### 劣化とは何か

**劣化とは**:
- 「当たらなくなる」❌
- **「人が触る頻度が増える」**⭕

### 劣化検知の3シグナル

**① 修正率**:
```
rule_hit 10回中、human_edit 2回以上 → 黄色信号
```
- **重要**: 修正率は「人が触った回数」であり、「誤り回数」ではない（監査視点）

**② confidence低下**:
- OCR confidence ↓
- anomaly_score ↑

**③ 時間経過**:
- 税制変更
- 運用変更
- 業務変化

### decay_score

**計算式**:
```
decay_score = edit_rate * 0.5
            + (1 - confidence) * 0.3
            + time_decay * 0.2
```

**閾値**:
- 0.5超 → auto_commit停止
- 0.7超 → ルール凍結
- 0.9超 → 破棄候補

### 降格フロー

```
AUTO_RULE → SUGGEST_ONLY → DISABLED
```

- **突然消さない**
- 人の信頼を壊さない

---

## 10. GA + AI 正規化詳細

### 正規化の3段階

**① 機械ルール（8割を捌く）**:
- 全角半角
- 記号除去
- 株式会社表記
- 数字マスク
- AI不要・激安

**② GA（探索・収束）**:
- 特徴量重み探索
- 適応度関数（人の確定仕訳ログとの一致率）
- パラメータ: population=50、generation=30

**③ AI（意味の最終判断）**:
- 境界判定のみ（similarity 0.80-0.92）
- 全体の3-7%のみ呼び出し
- Yes/No + 理由

**AIは"例外処理装置"であり、主処理系ではない**（AI暴走防止）。

### GAの役割

**GAがやること**:
- どの特徴量を、どれくらい重く見ると「同じ取引」判定が一番うまくいくか
- これは探索問題

**遺伝子（重み）例**:
```json
{
  "vendor_name": 0.40,
  "kana": 0.15,
  "layout_hash": 0.20,
  "amount_bucket": 0.15,
  "tax_pattern": 0.10
}
```
合計 = 1.0

**適応度関数**:
```
fitness = 正解一致数 / 判定回数
```
正解 = 人が「同一」と確定した履歴

**出力**:
```json
{
  "best_weights_version": "2026-02",
  "weights": {...},
  "accuracy": 0.93
}
```
月1回更新

### AIの役割

**AIを呼ぶ条件（必須）**:
```
0.80 <= similarity <= 0.92
```
- 高すぎ → 即OK
- 低すぎ → 即NG
- 境界だけAI

**プロンプト（最小）**:
```json
{
  "transaction_a": {
    "vendor": "ENEOS",
    "date": "2026-02-01",
    "amount": 5480,
    "tax": "10%"
  },
  "transaction_b": {
    "vendor": "エネオス○○SS",
    "date": "2026-02-01",
    "amount": 5478,
    "tax": "10%"
  },
  "similarity": 0.91
}
```

**期待レスポンス**:
```json
{
  "same_transaction": true,
  "confidence": 0.92,
  "reason": "同一店舗・同日・金額誤差が2円以内"
}
```

Yes / No + 理由だけ。

### コスト配分（15円/枚制約）

| 処理 | 円/枚 |
|------|-------|
| OCR | 5 |
| 正規化・類似 | 0.5 |
| AI境界 | 1 |
| その他 | 1 |
| **合計** | **7-9円** |

**15円？余裕で割る。**

---

## 11. 自動化率安全弁詳細

### なぜ自動化率が上がると危険か

- 誤りが静かに混入
- 人が見なくなる
- 事故が遅れて発覚

Streamedが絶対に避けているのは**「自動化の静かな事故」**。

### 安全弁①: 必ず「止める枠」を残す

```
自動確定上限 = 85%
```
- 残り15%は必ず人が見る

### 安全弁②: 金額・重要度ブレーキ

```
amount > 50,000 → auto_commit禁止
勘定科目 = 固定資産 → auto_commit禁止
```
- ルールがあっても止める

### 安全弁③: 定期リセット

**月次で必ずやる**:
- ルール命中率レビュー
- 劣化スコア再計算
- 自動化は「更新制」

### 安全弁④: ルール透明化UI

Streamed互換で必須:
- なぜ自動になったか
- どのルールか
- いつ作られたか

**ブラックボックス禁止**。

---

## 12. Phase 4への橋渡し

### status の再定義 → uiMode への影響

**現在のuiMode**:
```typescript
type JournalUiMode = 'editable' | 'remanded' | 'readonly' | 'fallback';
```

**Phase A確定後のuiMode（案）**:
```typescript
type JournalUiMode = 'editable' | 'needs_info' | 'readonly' | 'fallback';
```
- `remanded` → `needs_info` に変更

### readonly の意味 → disabled制御への影響

**Phase 4で保留した部分**:
- Step 4.3.11: 明細入力7項目のdisabled制御

**Phase A確定後の実装方針**:
- `uiMode === 'readonly'` のときのみ disabled
- `uiMode === 'needs_info'` は編集可能（判断保留中のため）

### label の役割 → UI表示への影響

**現在**: labelは未実装

**Phase A確定後**: labelをUI表示に使用
- 赤いバッジ（MULTI_TAX、LOW_OCR_CONF等）
- 警告アイコン
- ツールチップで詳細説明

---

## 13. 完了条件

Phase A概要ドキュメント（このファイル）の完了条件:

- [x] Phase Aの位置づけを明記
- [x] Streamed互換の定義を明確化
- [x] AIの位置づけを明確化
- [x] やらないことをリスト化
- [x] 税理士・会計士の価値を言語化
- [x] UIイメージを文章で記述
- [x] 設計への翻訳メモを作成
- [x] 学習ロジック詳細を記述（8章精査完了 2026-02-11）
- [x] ルール劣化・破棄ロジック詳細を記述（9章精査完了 2026-02-11）
- [x] GA + AI 正規化詳細を記述（10章精査完了 2026-02-11）
- [x] 自動化率安全弁詳細を記述（11章精査完了 2026-02-11）
- [x] Phase 4への橋渡しを明記

**検証レポート**: [verification_A00_detailed_sections.md](file:///C:/Users/kazen/.gemini/antigravity/brain/b317fb3f-1c5a-46ab-9b80-d50923f2ae26/verification_A00_detailed_sections.md)

### 次のステップ

- [ ] Task A.0.1: 前文の精査・修正（Day 3）外部レビュワー: AI）
