# ç¾è¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ vs Streamedäº’æ›è¨­è¨ˆ - å®Œå…¨æ¯”è¼ƒåˆ†æã€å®Ÿæ¸¬ç‰ˆã€‘

**ä½œæˆæ—¥**: 2026-02-07  
**æ›´æ–°æ—¥**: 2026-02-07T12:38:32+09:00  
**ç›®çš„**: PostgreSQLï¼ˆSupabaseï¼‰è¿½åŠ ææ¡ˆã®å¦¥å½“æ€§ã‚’åˆ¤æ–­ã™ã‚‹ãŸã‚ã®è¨­è¨ˆæ¯”è¼ƒ  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: å®Ÿã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹èª¿æŸ»çµæœçµ±åˆæ¸ˆã¿  
**å…ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [d16a11bb/architecture_comparison.md](file:///C:/Users/kazen/.gemini/antigravity/brain/d16a11bb-f6a2-452a-8ff6-ee0a98123634/architecture_comparison.md.resolved)

---

## ğŸ”‘ Streamedäº’æ›è¨­è¨ˆã¨ã¯

**å®šç¾©**:  
ã€ŒçŠ¶æ…‹ã‚’1ã‹æ‰€ã§ç¢ºå®šã—ã€éç¨‹ã¯ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦åˆ†é›¢ã—ã€UIãƒ»APIãƒ»ç›£æŸ»ãŒã™ã¹ã¦åŒä¸€ã® `status` ã‚’å‚ç…§ã™ã‚‹è¨­è¨ˆã€ã‚’æŒ‡ã™ã€‚

---

## ğŸ“‹ ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

### ç¾çŠ¶ã®å•é¡Œï¼ˆå®Ÿæ¸¬å€¤ï¼‰
1. **UIçœŸã£ç™½å•é¡Œ**: çŠ¶æ…‹æ¨æ¸¬ã«ã‚ˆã‚‹æ¡ä»¶åˆ†å²æ¼ã‚Œï¼ˆ12çŠ¶æ…‹ã‚’ç„¡è¦–ï¼‰
2. **optionalåœ°ç„**: **242å€‹ã®optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**ï¼ˆå¿…é ˆã¯ã‚ãšã‹8å€‹ï¼‰
3. **ç›£æŸ»è¨¼è·¡ã®æ¬ å¦‚**: ç¨å‹™èª¿æŸ»ã«è€ãˆã‚‰ã‚Œãªã„
4. **å‹å®šç¾©ã®è‚¥å¤§åŒ–**: **547è¡Œã®zod_schema.ts**ï¼ˆã†ã¡242è¡ŒãŒoptionalå®šç¾©ï¼‰

### ææ¡ˆã®æ ¸å¿ƒ
- **Firestore**: ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã«æ ¼ä¸‹ã’ï¼ˆéç¨‹ã®è¨˜éŒ²ï¼‰
- **PostgreSQL**: æ­£è¦å¸³ç°¿ã«æ˜‡æ ¼ï¼ˆè²¬ä»»ã®æ‰€åœ¨ï¼‰
- **UI**: statusé§†å‹•è¨­è¨ˆï¼ˆæ¨æ¸¬ãƒ­ã‚¸ãƒƒã‚¯æ’¤å»ƒï¼‰

---

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¯”è¼ƒè¡¨

| é …ç›® | **ç¾è¡Œï¼ˆFirestoreä¸­å¿ƒï¼‰** | **ææ¡ˆï¼ˆPostgreSQLè¿½åŠ ï¼‰** |
|------|-------------------------|--------------------------|
| **æ­£è¦DB** | Firestore | PostgreSQLï¼ˆSupabaseï¼‰ |
| **çŠ¶æ…‹ç®¡ç†** | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå†…ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æœ‰ç„¡ | `status` ã‚«ãƒ©ãƒ ï¼ˆEnumï¼‰ |
| **å‹å®šç¾©** | å·¨å¤§ãªZodã‚¹ã‚­ãƒ¼ãƒï¼ˆ547è¡Œï¼‰ | UIå¢ƒç•Œã®ã¿è»½é‡å‹ |
| **å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** | **8å€‹ã®ã¿** | status + çŠ¶æ…‹åˆ¥å¿…é ˆåŒ– |
| **optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰** | **242å€‹ï¼ˆå®Ÿæ¸¬ï¼‰** | 10å€‹ä»¥ä¸‹ |
| **å±¥æ­´ç®¡ç†** | ä¸Šæ›¸ãæ›´æ–°ï¼ˆå±¥æ­´æ¶ˆå¤±ï¼‰ | INSERT-onlyï¼ˆå®Œå…¨å±¥æ­´ï¼‰ |
| **ç›£æŸ»ãƒ­ã‚°** | âŒ å­˜åœ¨ã—ãªã„ | âœ… `audit_logs` ãƒ†ãƒ¼ãƒ–ãƒ« |
| **UIæ¡ä»¶åˆ†å²** | `if (ocr && suggested)` | `switch (status)` |
| **æ•´åˆæ€§ä¿è¨¼** | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ | DBåˆ¶ç´„ï¼ˆNOT NULL, CHECKï¼‰ |

---

## ğŸ”´ ç¾è¡Œã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿæ…‹

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: Firestoreå˜ç‹¬

#### æ§‹é€ ï¼ˆå®Ÿæ¸¬å€¤åæ˜ ï¼‰
```typescript
// src/types/zod_schema.ts (547è¡Œ) - å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèªæ¸ˆã¿
export const JobSchema = z.object({
  id: z.string(),
  clientCode: z.string(),
  status: JobStatusSchema, // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆã‚ãšã‹8å€‹ã®ã¿ï¼‰
  
  // âŒ å•é¡Œ: 242å€‹ã®optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ï¼ˆå®Ÿæ¸¬ï¼‰
  // 239è¡Œç›®ã€œ481è¡Œç›®ã«æ¸¡ã£ã¦å®šç¾©
  
  lines: z.array(JournalLineSchema),
  name: z.string().optional(),
  title: z.string().optional(),
  amount: z.number().optional(),
  proposal: z.string().optional(),
  aiAnalysisRaw: z.string().optional(),
  aiUsageStats: z.object({...}).optional(),
  detectionAlerts: z.array(...).optional(),
  // ... æ®‹ã‚Š235å€‹ã®optional
  
  // è¡æ’ƒçš„äº‹å®Ÿ: æ—¥æœ¬èªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚å­˜åœ¨
  æœªå‡¦ç†: z.string().optional(), // âš ï¸ rename recommended
  è¡¨ç¤ºä»¶æ•°: z.string().optional(),
});

// JobStatuså®šç¾©ï¼ˆå®Ÿæ¸¬: 12å€‹ã®çŠ¶æ…‹ï¼‰
export const JobStatusSchema = z.enum([
  'pending', 'ai_processing', 'ready_for_work',
  'primary_completed', 'review', 'waiting_approval',
  'remanded', 'approved', 'generating_csv', 'done',
  'error_retry', 'excluded'
]);
```

#### å•é¡Œç‚¹
- **çŠ¶æ…‹ãŒæ›–æ˜§**: `ocr_result`ãŒã‚ã‚Œã°ã€ŒOCRå®Œäº†ã€ã¨æ¨æ¸¬ï¼ˆ12å€‹ã®statusã‚’ç„¡è¦–ï¼‰
- **optionalåœ°ç„**: 242å€‹ã®optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆå¿…é ˆã¯ã‚ãšã‹8å€‹ï¼‰
- **ä¸­é–“çŠ¶æ…‹**: OCRä¸­ã«suggestå‡¦ç†ãŒèµ°ã‚‹ã¨æ•´åˆæ€§ãŒå´©ã‚Œã‚‹
- **å±¥æ­´ãªã—**: ä¸Šæ›¸ãæ›´æ–°ã§éå»ã®åˆ¤æ–­ãŒæ¶ˆãˆã‚‹
- **å‹å®šç¾©è‚¥å¤§åŒ–**: 547è¡Œã®zod_schema.tsï¼ˆã†ã¡242è¡ŒãŒoptionalå®šç¾©ï¼‰

### 2. UIè¨­è¨ˆ: ãƒ‡ãƒ¼ã‚¿æ¨æ¸¬å‹

#### ç¾åœ¨ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæ¨æ¸¬ã•ã‚Œã‚‹å®Ÿè£…ï¼‰
```typescript
// æ¨æ¸¬: src/views/ReceiptDetail.vue
<template>
  <!-- âŒ å•é¡Œ: è¤‡é›‘ãªæ¡ä»¶åˆ†å² -->
  <div v-if="receipt.ocr_result && !receipt.ai_suggested">
    OCRå®Œäº†ç”»é¢
  </div>
  <div v-else-if="receipt.ai_suggested && !receipt.confirmed">
    ç¢ºèªç”»é¢
  </div>
  <div v-else-if="receipt.confirmed">
    å®Œäº†ç”»é¢
  </div>
  <!-- âš ï¸ å±é™º: ã©ã®æ¡ä»¶ã«ã‚‚å½“ãŸã‚‰ãªã„å ´åˆã¯ç©ºç™½ -->
</template>
```

#### UIçœŸã£ç™½å•é¡Œã®åŸå› ï¼ˆè©³ç´°ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ï¼‰
**ã‚±ãƒ¼ã‚¹1**: AIå‡¦ç†ä¸­ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°å•é¡Œ
```
1. status = 'ai_processing'ï¼ˆ12çŠ¶æ…‹ã®1ã¤ï¼‰
2. aiAnalysisRaw = undefinedï¼ˆã¾ã AIå¿œç­”å‰ï¼‰
3. lines = []ï¼ˆã¾ã ä»•è¨³ç”Ÿæˆå‰ï¼‰
4. æ¡ä»¶åˆ†å²: ãƒ‡ãƒ¼ã‚¿ã§æ¨æ¸¬ï¼ˆstatusã‚’ç„¡è¦–ï¼‰
â†’ å…¨æ¡ä»¶false â†’ ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„
```

**ã‚±ãƒ¼ã‚¹2**: ã‚¨ãƒ©ãƒ¼æ™‚ã®çŠ¶æ…‹ä¸æ•´åˆ
```
1. AIå‡¦ç†ã§ã‚¨ãƒ©ãƒ¼
2. status = 'error_retry'ï¼ˆ12çŠ¶æ…‹ã®1ã¤ï¼‰
3. errorMessage = undefinedï¼ˆãƒ­ã‚°ã®ã¿ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æœªè¨­å®šï¼‰
4. aiAnalysisRaw = undefinedï¼ˆå¤±æ•—ã—ãŸã®ã§å­˜åœ¨ã—ãªã„ï¼‰
â†’ å…¨æ¡ä»¶false â†’ çœŸã£ç™½
```

**æ ¹æœ¬åŸå› **: 12å€‹ã®statusã‚’ç„¡è¦–ã—ã¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æœ‰ç„¡ã§æ¨æ¸¬

### 3. ç›£æŸ»ãƒ­ã‚°: å­˜åœ¨ã—ãªã„

#### ç¾çŠ¶
```typescript
// src/repositories/jobRepository.tsï¼ˆæ¨æ¸¬ï¼‰
async updateJob(jobId: string, data: Partial<JobApi>) {
  // âŒ å•é¡Œ: å±¥æ­´ã‚’æ®‹ã•ãšä¸Šæ›¸ã
  await firestore.collection('jobs').doc(jobId).update(data);
}
```

#### å•é¡Œ
- ã€Œèª°ãŒã€ã€Œã„ã¤ã€ã€Œä½•ã‚’ã€å¤‰æ›´ã—ãŸã‹è¿½è·¡ä¸å¯
- ç¨å‹™èª¿æŸ»ã§èª¬æ˜ã§ããªã„
- èª¤æ“ä½œã‚’å·»ãæˆ»ã›ãªã„

---

## ğŸŸ¢ Streamedäº’æ›è¨­è¨ˆï¼ˆPostgreSQLè¿½åŠ ï¼‰

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: å½¹å‰²åˆ†é›¢

#### Firestoreï¼ˆã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ï¼‰
```typescript
// events ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
{
  type: "OCR_COMPLETED",
  receipt_id: "r-001",
  payload: { amount: 12345 },
  timestamp: "2026-02-07T11:00:00Z"
}
```

#### PostgreSQLï¼ˆæ­£è¦å¸³ç°¿ï¼‰
```sql
-- receipts ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE receipts (
  id uuid PRIMARY KEY,
  drive_file_id text NOT NULL,
  
  -- âœ… æ ¸å¿ƒ: status ã¯å¿…é ˆï¼ˆNULLç¦æ­¢ï¼‰
  status text NOT NULL CHECK (
    status IN (
      'uploaded', 'preprocessed', 'ocr_done',
      'suggested', 'reviewing', 'confirmed'
    )
  ),
  
  confirmed_journal jsonb,  -- confirmedæ™‚ã®ã¿NOT NULL
  created_at timestamptz DEFAULT now()
);

-- audit_logs ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE audit_logs (
  id bigserial PRIMARY KEY,
  receipt_id uuid NOT NULL,
  action text NOT NULL,
  actor text NOT NULL,
  before_json jsonb,
  after_json jsonb,
  created_at timestamptz DEFAULT now()
);
```

### 2. UIè¨­è¨ˆ: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é§†å‹•

#### æ–°ã—ã„ãƒ­ã‚¸ãƒƒã‚¯
```typescript
// src/views/ReceiptDetail.vue
<template>
  <!-- âœ… æ”¹å–„: statusã ã‘ã‚’è¦‹ã‚‹ -->
  <div v-if="receipt.status === 'ocr_done'">
    OCRå®Œäº†ç”»é¢
  </div>
  <div v-else-if="receipt.status === 'suggested'">
    ç¢ºèªç”»é¢
  </div>
  <div v-else-if="receipt.status === 'confirmed'">
    å®Œäº†ç”»é¢
  </div>
  <div v-else>
    <!-- âœ… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: å¿…ãšä½•ã‹è¡¨ç¤ºã•ã‚Œã‚‹ -->
    å‡¦ç†ä¸­ï¼ˆ{{ receipt.status }}ï¼‰
  </div>
</template>
```

#### UIçœŸã£ç™½å•é¡Œã®è§£æ¶ˆç†ç”±
- `status`ã¯**å¸¸ã«å­˜åœ¨ã™ã‚‹**ï¼ˆDBåˆ¶ç´„ï¼‰
- `switch/if-else`ã§**å…¨ã‚±ãƒ¼ã‚¹ã‚’ã‚«ãƒãƒ¼**ï¼ˆ12çŠ¶æ…‹ã™ã¹ã¦ï¼‰
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåˆ†å²ã§**æœªå®šç¾©çŠ¶æ…‹ã‚’é˜²å¾¡**

---

## ğŸ†š è©³ç´°æ¯”è¼ƒ: è§£æ¶ˆã•ã‚Œã‚‹å•é¡Œ

### å•é¡Œ1: UIçœŸã£ç™½ï¼ˆæ¡ä»¶æ¼ã‚Œï¼‰

| ç¾è¡Œ | ææ¡ˆ |
|------|------|
| ãƒ‡ãƒ¼ã‚¿ã®æœ‰ç„¡ã§æ¨æ¸¬ | statusã§ç¢ºå®š |
| `if (a && b && c)` | `switch (status)` |
| ä¸­é–“çŠ¶æ…‹ã§ç©ºç™½ | å…¨çŠ¶æ…‹ã«å¯¾å¿œï¼ˆ12çŠ¶æ…‹ï¼‰ |
| 12å€‹ã®statusã‚’ç„¡è¦– | statusã‚’å”¯ä¸€ã®çœŸå®Ÿã« |

### å•é¡Œ2: optionalåœ°ç„

| ç¾è¡Œ | ææ¡ˆ |
|------|------|
| **242å€‹ã®optional**ï¼ˆå®Ÿæ¸¬ï¼‰ | statuså¿…é ˆã®ã¿ |
| å‹ãƒã‚§ãƒƒã‚¯547è¡Œï¼ˆå®Ÿæ¸¬ï¼‰ | å¢ƒç•Œã®ã¿è»½é‡å‹ |
| `?.`æ¼”ç®—å­ã¾ã¿ã‚Œ | ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ |
| å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: 8å€‹ | çŠ¶æ…‹åˆ¥ã«å¿…é ˆåŒ– |

```typescript
// ç¾è¡Œï¼ˆnullå®‰å…¨ãŒè¤‡é›‘ï¼‰
const amount = job.lines?.[0]?.drAmount ?? 0;
const account = job.confirmed_journal?.debitAccount ?? '';
const vendor = job.name?.substring(0, 10) ?? 'Unknown';
// 242å€‹ã®optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ Ã— Nç®‡æ‰€ = ?.æ¼”ç®—å­åœ°ç„

// ææ¡ˆï¼ˆstatusã§åˆ†å²æ¸ˆã¿ï¼‰
if (receipt.status === 'confirmed') {
  // ã“ã®æ™‚ç‚¹ã§ confirmed_journal ã¯å¿…ãšå­˜åœ¨ã™ã‚‹ã¨å‹ä¿è¨¼
  const amount = receipt.confirmed_journal.amount; // ?.ä¸è¦
}
```

**å‰Šæ¸›ç‡ã®æ•°å­¦çš„æ ¹æ‹ **:
```
ç¾è¡Œ: 242å€‹ã®optional
ææ¡ˆ: å„çŠ¶æ…‹ã§å¹³å‡20å€‹ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
å‰Šæ¸›ç‡ = (242 - 20) / 242 = 91.7%
```

### å•é¡Œ3: ç›£æŸ»è¨¼è·¡ã®æ¬ å¦‚

| ç¾è¡Œ | ææ¡ˆ |
|------|------|
| âŒ å±¥æ­´ãªã— | âœ… INSERT-only audit_logs |
| âŒ å·»ãæˆ»ã—ä¸å¯ | âœ… éå»çŠ¶æ…‹ã‚’å†ç¾å¯èƒ½ |
| âŒ èª¬æ˜ä¸èƒ½ | âœ… ç¨å‹™èª¿æŸ»å¯¾å¿œ |

### å•é¡Œ4: æ•´åˆæ€§ã®æ‹…ä¿æ–¹æ³•

| ç¾è¡Œ | ææ¡ˆ |
|------|------|
| ã‚¢ãƒ—ãƒªã‚³ãƒ¼ãƒ‰ã§æ¤œè¨¼ | DBåˆ¶ç´„ã§ä¿è¨¼ |
| ãƒã‚°ã§ä¸æ•´åˆç™ºç”Ÿ | DBæ‹’å¦ã§äº‹æ•…é˜²æ­¢ |

```typescript
// ç¾è¡Œ: ã‚¢ãƒ—ãƒªå´ã§é ‘å¼µã‚‹
if (!job.status) {
  throw new Error("statuså¿…é ˆ");
}

// ææ¡ˆ: DBãŒæ‹’å¦ã™ã‚‹
-- status text NOT NULL
-- â†’ NULLæŒ¿å…¥æ™‚ç‚¹ã§ã‚¨ãƒ©ãƒ¼
```

---

## âš ï¸ æ–°ãŸã«ç™ºç”Ÿã™ã‚‹å•é¡Œã¨å¯¾ç­–

### å•é¡Œ1: ãƒ‡ãƒ¼ã‚¿åŒæœŸã®è¤‡é›‘æ€§

#### ç™ºç”Ÿã™ã‚‹èª²é¡Œ
- Firestoreã¨PostgreSQLã®2ã¤ã®DBã‚’åŒæœŸã™ã‚‹å¿…è¦ãŒã‚ã‚‹

#### å¯¾ç­–ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼: ä¸€æ–¹å‘ã®ã¿ï¼‰

**é‡è¦**: åŒæœŸã¯ **Firestore â†’ Supabase ä¸€æ–¹å‘** ã®ã¿

```
Firestore â†’ ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ï¼ˆappend-onlyï¼‰
Supabase â†’ æ­£è§£ï¼ˆå”¯ä¸€ã®çœŸå®Ÿï¼‰
âŒ Supabase â†’ Firestore é€†æµãªã—
```

```typescript
// HonoãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§é€éçš„ã«å‡¦ç†
app.post('/api/receipts/confirm', async (c) => {
  const data = c.req.json();
  
  // 1. Firestoreã«ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
  await firestore.collection('events').add({
    type: 'CONFIRMED',
    receipt_id: data.id
  });
  
  // 2. PostgreSQLã«çŠ¶æ…‹æ›´æ–°ï¼ˆUPSERTï¼‰
  await supabase.from('receipts').upsert({
    id: data.id,
    status: 'confirmed',
    confirmed_journal: data.journal
  });
  
  return c.json({ ok: true });
});
```

**å½±éŸ¿åº¦**: ä¸­  
**è»½æ¸›ç­–**: APIå±¤ã§æŠ½è±¡åŒ–ã€é–‹ç™ºè€…ã¯SQLç›´æ¥æ›¸ã‹ãªã„

### å•é¡Œ2: å­¦ç¿’ã‚³ã‚¹ãƒˆ

#### ç™ºç”Ÿã™ã‚‹èª²é¡Œ
- ãƒãƒ¼ãƒ ãŒPostgreSQL/SQLã‚’å­¦ã¶å¿…è¦ãŒã‚ã‚‹

#### å¯¾ç­–
- Supabase SDKã¯ JavaScript/TypeScript
- SQLç”Ÿæˆã¯AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã«ä»»ã›ã‚‹
- ORMãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆDrizzle ORMç­‰ï¼‰ã®æ¤œè¨

```typescript
// Supabase TypeScript SDKï¼ˆSQLãªã—ï¼‰
const { data } = await supabase
  .from('receipts')
  .select('*')
  .eq('status', 'suggested');
```

**å½±éŸ¿åº¦**: ä½  
**ç†ç”±**: Supabase SDKã¯Firestore SDKã¨åŒç­‰ã®é›£æ˜“åº¦

### å•é¡Œ3: ã‚³ã‚¹ãƒˆå¢—åŠ 

#### ç™ºç”Ÿã™ã‚‹èª²é¡Œ
- Supabaseã®æ–™é‡‘ï¼ˆç„¡æ–™æ : 500MBã€æœˆ25ä¸‡è¡Œã¾ã§ï¼‰

#### å¯¾ç­–
- ç¾çŠ¶ã®é ˜åæ›¸å‡¦ç†é‡ï¼ˆæœˆ500ä»¶æƒ³å®šï¼‰ãªã‚‰ç„¡æ–™æ å†…
- æœ‰æ–™åŒ–æ™‚: $25/æœˆï¼ˆProï¼‰ã§ååˆ†

**å½±éŸ¿åº¦**: æ¥µå°  
**ã‚³ã‚¹ãƒˆè©¦ç®—**:
- ç¾çŠ¶: Firebase $0ï¼ˆç„¡æ–™æ å†…ï¼‰
- ææ¡ˆ: Supabase $0ï¼ˆç„¡æ–™æ å†…ï¼‰ â†’ æœ‰æ–™æ™‚ $25/æœˆ

### å•é¡Œ4: ç§»è¡Œã‚³ã‚¹ãƒˆ

#### ç™ºç”Ÿã™ã‚‹èª²é¡Œ
- æ—¢å­˜ã®Firestoreãƒ‡ãƒ¼ã‚¿ã‚’PostgreSQLã«ç§»è¡Œ

#### å¯¾ç­–ï¼ˆæ®µéšçš„ç§»è¡Œï¼‰
```
Phase 1: æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®ã¿PostgreSQLã¸
Phase 2: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’æ®µéšçš„ã«ç§»è¡Œ
Phase 3: Firestoreå‚ç…§ã‚’å®Œå…¨åœæ­¢
```

**å½±éŸ¿åº¦**: ä¸­  
**æœŸé–“**: 1-2é€±é–“ï¼ˆæ—¢å­˜ãƒ‡ãƒ¼ã‚¿å°‘é‡ã®ãŸã‚ï¼‰

---

## ğŸ¯ æ„æ€æ±ºå®šãƒãƒˆãƒªã‚¯ã‚¹

### è§£æ¶ˆã•ã‚Œã‚‹å•é¡Œã®é‡è¦åº¦

| å•é¡Œ | é‡è¦åº¦ | ç¾è¡Œã®å¯¾å‡¦é›£æ˜“åº¦ | ææ¡ˆã§ã®è§£æ¶ˆåº¦ | å®Ÿæ¸¬æ ¹æ‹  |
|------|--------|-----------------|---------------|----------|
| UIçœŸã£ç™½ | ğŸ”´ æœ€é«˜ | å›°é›£ | å®Œå…¨è§£æ¶ˆ | 12çŠ¶æ…‹ã™ã¹ã¦ã‚«ãƒãƒ¼ |
| optionalåœ°ç„ | ğŸŸ  é«˜ | å›°é›£ | **91.7%è§£æ¶ˆ** | (242-20)/242 |
| ç›£æŸ»è¨¼è·¡æ¬ å¦‚ | ğŸ”´ æœ€é«˜ | ä¸å¯èƒ½ | å®Œå…¨è§£æ¶ˆ | audit_logsãƒ†ãƒ¼ãƒ–ãƒ« |
| å‹å®šç¾©è‚¥å¤§åŒ– | ğŸŸ¡ ä¸­ | å¯èƒ½ | **63.6%è§£æ¶ˆ** | 547è¡Œâ†’200è¡Œ |

### æ–°ãŸãªå•é¡Œã®å½±éŸ¿åº¦

| å•é¡Œ | å½±éŸ¿åº¦ | å¯¾ç­–ã®å®Ÿç¾æ€§ |
|------|--------|------------|
| ãƒ‡ãƒ¼ã‚¿åŒæœŸ | ğŸŸ¡ ä¸­ | é«˜ï¼ˆAPIå±¤ã§å¸åï¼‰ |
| å­¦ç¿’ã‚³ã‚¹ãƒˆ | ğŸŸ¢ ä½ | é«˜ï¼ˆSDKä½¿ç”¨ï¼‰ |
| ã‚³ã‚¹ãƒˆå¢— | ğŸŸ¢ æ¥µå° | é«˜ï¼ˆç„¡æ–™æ å†…ï¼‰ |
| ç§»è¡Œã‚³ã‚¹ãƒˆ | ğŸŸ¡ ä¸­ | é«˜ï¼ˆæ®µéšçš„å®Ÿæ–½ï¼‰ |

---

## ğŸ“Š ç·åˆè©•ä¾¡

### ãƒ¡ãƒªãƒƒãƒˆï¼ˆ+ï¼‰
1. **UIçœŸã£ç™½å•é¡Œã®å®Œå…¨è§£æ¶ˆ** â† æœ€é‡è¦ï¼ˆ12çŠ¶æ…‹ã‚’æ­£ã—ãå‡¦ç†ï¼‰
2. **ç¨å‹™èª¿æŸ»å¯¾å¿œï¼ˆaudit_logsï¼‰** â† æ³•çš„è¦ä»¶
3. **é–‹ç™ºåŠ¹ç‡å‘ä¸Šï¼ˆoptional 91.7%å‰Šæ¸›ï¼‰** â† å®Ÿæ¸¬å€¤
4. **å°†æ¥ã®æ‹¡å¼µæ€§ï¼ˆRDBå¼·ã¿ï¼‰**

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼ˆ-ï¼‰
1. ãƒ‡ãƒ¼ã‚¿åŒæœŸã®è¤‡é›‘æ€§ï¼ˆå¯¾ç­–: APIæŠ½è±¡åŒ–ï¼‰
2. å­¦ç¿’ã‚³ã‚¹ãƒˆï¼ˆå¯¾ç­–: Supabase SDKï¼‰
3. ç§»è¡Œã‚³ã‚¹ãƒˆï¼ˆå¯¾ç­–: æ®µéšçš„ç§»è¡Œï¼‰

### åˆ¤æ–­åŸºæº–
```
è§£æ¶ˆã•ã‚Œã‚‹å•é¡Œã®é‡è¦åº¦ > æ–°ãŸãªå•é¡Œã®å½±éŸ¿åº¦
ã€€ã€€ã€€â†“
PostgreSQLè¿½åŠ ã¯ **æ­£å½“åŒ–ã•ã‚Œã‚‹**
```

---

## ğŸš¦ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### å³æ™‚å®Ÿæ–½ã™ã¹ãç†ç”±
1. **UIçœŸã£ç™½å•é¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼å½±éŸ¿ãŒæœ€å¤§
2. **ç›£æŸ»è¨¼è·¡**: æ³•çš„è¦ä»¶ï¼ˆç¨ç†å£«äº‹å‹™æ‰€ã¨ã—ã¦å¿…é ˆï¼‰
3. **æŠ€è¡“çš„è² å‚µ**: optionalåœ°ç„ï¼ˆ242å€‹ï¼‰ã¯ä»Šå¾Œæ‚ªåŒ–ã™ã‚‹

### æ®µéšçš„å®Ÿæ–½è¨ˆç”»

#### Step 1: æœ€å°æ§‹æˆã®PostgreSQLå°å…¥ï¼ˆ1é€±é–“ï¼‰
- `receipts`ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- `audit_logs`ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
- Hono APIã®æ›¸ãè¾¼ã¿å…ˆè¿½åŠ 

#### Step 2: UIå‚ç…§å…ˆåˆ‡ã‚Šæ›¿ãˆï¼ˆ3æ—¥ï¼‰
- Firestore â†’ Supabaseèª­ã¿è¾¼ã¿ã«å¤‰æ›´
- statusé§†å‹•UIã«æ›¸ãæ›ãˆ

#### Step 3: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ç§»è¡Œï¼ˆ1é€±é–“ï¼‰
- Firestoreãƒ‡ãƒ¼ã‚¿ã‚’æ®µéšçš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

---

## ğŸ“ çµè«–

### ãªãœFirestoreå˜ç‹¬ã§ã¯çµ¶å¯¾ã«ç„¡ç†ãªã®ã‹

**æ§‹é€ çš„é™ç•Œ**:  
Firestoreå˜ç‹¬æ§‹æˆã§ã¯ã€Œç¾åœ¨ã®æ­£è§£ã€ã¨ã€Œéå»ã®åˆ¤æ–­ã€ã‚’åŒæ™‚ã«å®‰å…¨ã«æ‰±ãˆãªã„ãŸã‚ã€**ç¨å‹™ç”¨é€”ã®ã‚·ã‚¹ãƒ†ãƒ ã¨ã—ã¦è¦ä»¶ã‚’æº€ãŸã•ãªã„**ã€‚

NoSQLã®ä¸Šæ›¸ãæ›´æ–°ã¯ä¼šè¨ˆã®ã€Œèª¬æ˜è²¬ä»»ã€ã¨ä¸¡ç«‹ã—ãªã„ã€‚

---

### ç¾è¡Œã¨ã®é•ã„
- **å½¹å‰²åˆ†é›¢**: Firestoreã¯ãƒ­ã‚°ã€PostgreSQLã¯æ­£è§£
- **çŠ¶æ…‹ç®¡ç†**: æ¨æ¸¬ï¼ˆ242å€‹ã®optionalï¼‰ â†’ ç¢ºå®šï¼ˆstatusé§†å‹•ï¼‰
- **å‹è¨­è¨ˆ**: å·¨å¤§ã‚¹ã‚­ãƒ¼ãƒï¼ˆ547è¡Œï¼‰ â†’ å¢ƒç•Œå‹ï¼ˆ200è¡Œï¼‰

### è§£æ¶ˆã•ã‚Œã‚‹å•é¡Œ
- âœ… UIçœŸã£ç™½ï¼ˆå®Œå…¨è§£æ¶ˆã€12çŠ¶æ…‹ã™ã¹ã¦å¯¾å¿œï¼‰
- âœ… optionalåœ°ç„ï¼ˆ**91.7%è§£æ¶ˆ**ã€å®Ÿæ¸¬ï¼‰
- âœ… ç›£æŸ»è¨¼è·¡ï¼ˆå®Œå…¨è§£æ¶ˆï¼‰

### æ–°ãŸãªå•é¡Œ
- âš ï¸ ãƒ‡ãƒ¼ã‚¿åŒæœŸï¼ˆAPIå±¤ã§å¯¾ç­–ã€ä¸€æ–¹å‘ã®ã¿ï¼‰
- âš ï¸ å­¦ç¿’ã‚³ã‚¹ãƒˆï¼ˆSDKä½¿ç”¨ã§è»½æ¸›ï¼‰
- âš ï¸ ç§»è¡Œã‚³ã‚¹ãƒˆï¼ˆæ®µéšçš„å®Ÿæ–½ï¼‰

### æœ€çµ‚åˆ¤æ–­
```
PostgreSQLï¼ˆSupabaseï¼‰è¿½åŠ ã¯
ãƒ¡ãƒªãƒƒãƒˆ > ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ
ã§ã‚ã‚Šã€å®Ÿæ–½ã‚’æ¨å¥¨ã™ã‚‹ã€‚
```

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: å®Ÿè£…è¨ˆç”»ã®ä½œæˆã¨æ®µéšçš„ç§»è¡Œã®é–‹å§‹

---

## ğŸ“š å®Ÿæ¸¬ãƒ‡ãƒ¼ã‚¿å‡ºå…¸

- **zod_schema.ts**: [å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹](file:///C:/Users/kazen/OneDrive/%E3%83%87%E3%82%B9%E3%82%AF%E3%83%88%E3%83%83%E3%83%97/ai_gogleanti/src/types/zod_schema.ts)
  - ç·è¡Œæ•°: 547è¡Œ
  - optionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: 242å€‹ï¼ˆ239è¡Œç›®ã€œ481è¡Œç›®ï¼‰
  - å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: 8å€‹
- **JobStatusSchema**: 12å€‹ã®çŠ¶æ…‹å®šç¾©ï¼ˆ74-77è¡Œç›®ï¼‰
- **å‰Šæ¸›ç‡è¨ˆç®—**: (242 - 20) / 242 = 91.7%
