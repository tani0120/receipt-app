# Phase A: Streamed互換・設計パラダイム定義 実装計画

## 0. Phase Aの位置づけ

**Phase Aとは**:
- 数字Phase（1,2,3,4...）とは直交する設計パラダイム定義フェーズ
- 時間順ではなく、優先順位が上位
- Phase 4の「前提」を再定義するため、Phase 4完了前に実施

**背景**:
Phase 4（Journal UI Refactor）の実装中、以下の違和感が発生：

1. **remanded（差戻し）の概念が実態と合わない**
   - 想定: 「上席が修正指示」（レビュー差戻し型フロー）
   - 実態: 「判断に必要な情報が足りない」（判断保留）

2. **readonly の発生条件が曖昧**
   - 当初: Submitted / Approved で readonly
   - 再考: 承認後のみ readonly が自然

3. **Streamed互換の必要性**
   - イベント駆動 × 状態タグ の設計が必要
   - statusは「結果」ではなく「途中経過」

**結論**:
Phase 4を「地図を書き換えてる最中に家を建てる」状態にしないため、Phase Aで前提を確定させる。

---

## 1. Phase Aの目的

### **主目的**:
status / label / readonly の意味論をイベント視点で再定義し、Streamed互換の設計前提を確立する

### **具体的な成果物**:
1. status/label/readonly 再定義（確定版）
2. Streamed互換の概念定義
3. Phase 4再設計の指針

---

## 2. 実施内容

### **2.0. Phase A 概要ドキュメント（自然言語）**

**目的**: 設計を書く前の設計 = 思想・価値・前提条件の固定

**やること**:

#### 基本セクション
- [ ] Streamed互換の本質を自然言語で整理
  - なぜ「Streamed互換」なのか
  - なぜ「再現」ではダメなのか
  - 互換とは何を合わせることか
- [ ] AIの位置づけを明確化
  - 判断しない
  - 補助する（正規化・類似度・説明生成）
  - 説明する（なぜ止めたか）
- [ ] このシステムが「やらないこと」をリスト化
  - 勝手に確定しない
  - 想像で補完しない
  - グローバル学習しない
  - 自動化率を競わない
- [ ] 税理士・会計士にとっての価値
  - 何が「安心」なのか
  - 止める設計、説明できる設計
- [ ] UIイメージ（体験）
  - 自動になった理由が常に見える
  - 止まった理由が一行で分かる
  - 直した瞬間に「今後どうするか」を聞かれる
  - OFFがONより目立つ
- [ ] 設計への翻訳メモ
  - status は「進捗」ではなく「判断可能性」
  - label は「注意喚起」
  - readonly は「責任確定」

#### 詳細セクション（Streamed互換の実装前提）
- [ ] 学習ロジックの詳細定義
  - 人修正ログの構造
  - 閾値更新アルゴリズム（confidence、anomaly_score、auto_commit条件）
  - 顧問先ローカルルール生成条件（同一条件2回連続）
  - ルール候補の昇格・降格フロー
- [ ] ルール劣化・破棄ロジックの詳細定義
  - 劣化検知3シグナル（修正率、confidence低下、時間経過）
  - **修正率は「人が触った回数」であり、「誤り回数」ではない**（監査視点）
  - decay_score計算式
  - 降格フロー（AUTO_RULE → SUGGEST_ONLY → DISABLED）
  - 破棄条件（decay_score > 0.9）
- [ ] GA + AI 正規化の詳細定義
  - GAの役割（特徴量重み探索、適応度関数）
  - AIの役割（境界判定0.80-0.92、全体の3-7%のみ）
  - **AIは"例外処理装置"であり、主処理系ではない**（AI暴走防止）
  - 処理フロー（機械正規化 → GA類似計算 → AI境界判定）
  - コスト配分（OCR 5円、正規化 0.5円、AI 1円、合計7-9円/枚）
- [ ] 自動化率安全弁の詳細定義
  - 上限85%のハード制限
  - 金額・重要度ブレーキ（>50,000円、固定資産）
  - 定期リセット（月次）
  - ルール透明化UI

**成果物**: `concept_phaseA_overview_260208.md`

**構成**:
1. Phase Aの位置づけ
2. なぜStreamed互換か
3. Streamed互換の定義
4. AIの位置づけ
5. やらないこと
6. 税理士・会計士の価値
7. UIイメージ
8. 設計への翻訳メモ
9. 学習ロジック詳細
10. ルール劣化・破棄ロジック詳細
11. GA + AI 正規化詳細
12. 自動化率安全弁詳細
13. Phase 4への橋渡し

**依存**: なし（Phase A最初のタスク）

---

### **2.1. status/label/readonly 再定義（確定版）**

**現状**: `decision_phase4_status_redefinition_v01_260208.md` にドラフト v0.1 が存在

**やること**:
- [ ] v0.1 をレビュー
- [ ] 不明点・矛盾点を洗い出し
- [ ] v1.0 として確定
- [ ] Phase 4への影響を明記

**成果物**: `decision_phaseA_status_redefinition_v10_260208.md`

---

### **2.2. Streamed互換の概念定義**

**目的**: Streamedとは何を保証する設計か、を言語化

**やること**:
- [ ] Streamed互換とは何か
- [ ] status / label / readonly が イベントストリーム上でどう振る舞うか
- [ ] 「判断保留（NEEDS_INFO）」がどのイベントか
- [ ] APPROVED が不可逆イベントかどうか
- [ ] イベント駆動設計の責務分離

**成果物**: `plan_phaseA_streamed_concept_260208.md`

---

### **2.3. Phase 4再設計の指針**

**目的**: Phase A確定後、Phase 4をどう再開するか

**やること**:
- [ ] Phase 4のどこを修正するか
- [ ] uiMode の再設計
- [ ] 明細7項目disabled制御の実装方針

**成果物**: `decision_phaseA_phase4_redesign_bridge_260208.md`

---

## 3. 未決事項

Phase A開始時点で未決：

- [ ] Phase番号は Phase 5 or Phase X or Phase A のどれか → **Phase A で確定**
- [ ] brain/ と genzai/NEW/ の整理方針 → **確定待ち**
- [ ] Streamed の詳細仕様（この段階では「概念のみ」）

---

## 4. 完了条件

- [ ] status/label/readonly v1.0 確定
- [ ] Streamed互換の概念定義完了
- [ ] Phase 4再設計指針確定
- [ ] Phase 4 再開可能な状態
