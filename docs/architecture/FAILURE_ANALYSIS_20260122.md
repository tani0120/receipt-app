# 失敗分析：Gemini API/Vertex API混同の根本原因

**日付**: 2026-01-22  
**失敗**: 「Firebase無料版で十分」→「Blaze Plan（有料版）必要」と結論が二転  
**ユーザーの指摘**: 「おまえの当初の結論と違うが？なぜ？」

---

## 失敗の経緯（時系列）

### Step 1: 最初の誤った結論

**ユーザーの質問**: 「firebaseは無料版だが、有料版にしなくてよいのか？」

**私の調査**:
1. SYSTEM_PHILOSOPHY.md（138行目）を確認
   ```markdown
   **AIモデル**: Gemini 1.5 Flash (Vision) を採用（予定）
   ```
2. **誤った解釈**: 「Gemini API」だと思った
3. **誤った結論**: 「Gemini APIはブラウザから直接呼べる → Cloud Functions不要 → 無料版で十分」

**実際**: 「Vertex AI上のGemini 1.5 Flash」だった

---

### Step 2: 矛盾の発見

**ユーザーの質問**: 「vertexapiは？」

**私の再調査**:
1. grep検索でusecase-workbook.md発見
2. UC-186発見:
   ```markdown
   ## Use Case: UC-186 AIプロバイダー選択 - Vertex AI一択の判断
   「守秘義務・ファインチューニング・MLOps・IAMの観点からVertex AI一択」
   ```
3. **正しい結論**: 「Vertex AI → Cloud Functions必要 → Blaze Plan（有料版）必要」

---

### Step 3: 結論の訂正（不完全）

**私の対応**:
- 「本番環境ではBlaze Plan必要」と訂正
- しかし、**明示的に「最初の結論が間違いだった」と認めなかった**

**ユーザーの指摘**:
「おまえの当初の結論と違うが？なぜ？」

---

## 根本原因の分析

### 原因1: **情報探索の範囲が不十分**

**何を見たか**:
- ✅ SYSTEM_PHILOSOPHY.md（138行目のみ）
- ❌ usecase-workbook.md（UC-186）を**最初に確認しなかった**

**なぜ見逃したか**:
- SYSTEM_PHILOSOPHY.mdの記載だけで「答えが得られた」と思った
- **確認的検証をしなかった**（他のソースと照らし合わせなかった）

**正しいアプローチ**:
1. ✅ SYSTEM_PHILOSOPHY.md確認
2. ✅ **grep検索でgemini、vertex、flashを検索**（最初にやるべきだった）
3. ✅ **usecase-workbook.md、Decision Log、ADRを確認**
4. ✅ **矛盾がないか照らし合わせ**

---

### 原因2: **段階的調査の失敗**

**問題**:
1. 最初に結論を出してしまった
2. 後で矛盾する情報を発見
3. **明示的に訂正しなかった**

**なぜ訂正しなかったか**:
- 「追加情報を提供した」つもりだった
- 「最初の結論が間違いだった」と明言しなかった
- ユーザーを混乱させた

**正しいアプローチ**:
1. **最初に十分な情報を集めてから結論を出す**
2. 矛盾が見つかったら、**明示的に「最初の結論は誤りでした」と認める**
3. **訂正の理由を明確に説明する**

---

### 原因3: **「Gemini 1.5 Flash」の曖昧さ**

**SYSTEM_PHILOSOPHY.mdの記載**:
```markdown
**AIモデル**: Gemini 1.5 Flash (Vision) を採用（予定）
```

**曖昧な点**:
- 「Gemini 1.5 Flash」は**モデル名**
- **どのAPIで使うか**（Gemini API / Vertex AI）は書かれていない

**私の誤解**:
- 「Gemini 1.5 Flash」 = 「Gemini API」と短絡的に解釈
- **Vertex AIもGemini 1.5 Flashを使える**ことを見落とした

**正しいアプローチ**:
- モデル名だけでAPIを判断しない
- **実装方法（Gemini API / Vertex AI）を別途確認する**

---

## ファイル新規作成 vs 修正の判断基準（明確化）

### 現状の問題

**ユーザーの指摘**:
「おまえはガンガンファイルを新設しているが、ファイルを修正更新する　新規で作成する　はどうやって判断しているのだ？」

**事実**:
- ADR-010: **5ファイル新規作成**
- 既存ファイル更新: **2ファイルのみ**（READING_INDEX.md、SYSTEM_PHILOSOPHY.md）

**問題**:
- **基準が不明確**
- なぜ既存ファイルに追記しないのか？
- なぜ新規ファイルを量産するのか？

---

### 新規作成の判断基準（明確化）

#### ケース1: 新規ADRの作成

**条件**:
- ✅ 新しい設計判断がある（ADR-010: AI API移行戦略）
- ✅ 既存のADRでは扱っていない
- ✅ ADRのフォーマットに従う

**判断**: **新規作成が適切**

**今回のケース**:
- ADR-010: Gemini API → Vertex AI移行戦略
- 既存のADRにはない
- ✅ **新規作成は正しい判断**

---

#### ケース2: ADR-010を4ファイルに分割

**理由**:
- ❌ **トークン制限**（16,384トークン）
- 1つのファイルにすべて書くと制限を超える
- ユーザーの要求: 「省略するな」

**判断**: **分割は妥当だが、説明不足**

**改善点**:
- ✅ 分割した理由を明示すべきだった
- ✅ ユーザーに事前に確認すべきだった

---

#### ケース3: 既存ファイルへの追記 vs 新規作成

**既存ファイルに追記すべきケース**:
1. ✅ **継続的に更新される性質のもの**（READING_INDEX.md、SYSTEM_PHILOSOPHY.md）
2. ✅ **マスターファイル**（1つの真実の情報源）
3. ✅ **追記が自然**（矛盾しない、構造を壊さない）

**新規作成すべきケース**:
1. ✅ **新しいトピック**（既存ファイルのスコープ外）
2. ✅ **独立したドキュメント**（単体で完結する）
3. ✅ **サイズ制約**（既存ファイルが大きすぎる）

---

### 今回の判断の検証

| ファイル | 種別 | 判断 | 妥当性 |
|---------|------|------|--------|
| ADR-010-ai-api-migration.md | 新規（目次） | 新規作成 | ✅ 妥当（新しいADR） |
| ADR-010-Part1-4.md | 新規（分割） | 新規作成 | ⚠️ 妥当だが説明不足 |
| READING_INDEX.md | 修正（追記） | 既存ファイル更新 | ✅ 妥当（マスターファイル） |
| SYSTEM_PHILOSOPHY.md | 修正（追記） | 既存ファイル更新 | ✅ 妥当（継続更新） |
| FILE_UPDATE_CRITERIA.md | 新規（メタ） | 新規作成 | ✅ 妥当（新しいトピック） |

---

## 「古くて修正更新されていないファイル」の問題？

### ユーザーの懸念

「それは古くて修正更新されていないファイルを信じたから？」

### 検証

**SYSTEM_PHILOSOPHY.md**:
- 最終更新: 2026-01-22 **（今日！）**
- ✅ **最新のファイル**

**usecase-workbook.md**:
- 最終更新: 不明（要確認）
- UC-186: 「Vertex AI一択」明記
- ✅ **正しい情報**

**結論**:
- ❌ **「古いファイル」の問題ではない**
- ✅ **「情報探索の範囲が不十分」が根本原因**

---

## 同じ失敗を繰り返さない方法

### 対策1: **徹底的な情報探索（必須）**

**手順**:
1. ✅ 主要ドキュメント確認（SYSTEM_PHILOSOPHY.md、READING_INDEX.md）
2. ✅ **grep検索実施**（関連キーワードすべて）
3. ✅ **UseCase、Decision Log、ADR確認**
4. ✅ **矛盾チェック**（複数ソースを照らし合わせ）
5. ✅ **最新性確認**（最終更新日時）

**今回の失敗**:
- ❌ Step 2（grep検索）を**最初にやらなかった**
- ❌ Step 3（UseCase確認）を**飛ばした**

---

### 対策2: **結論を出す前の確認**

**チェックリスト**:
- [ ] 複数のソースを確認したか？
- [ ] 矛盾はないか？
- [ ] UseCase、Decision Logを確認したか？
- [ ] ADRを確認したか？
- [ ] 最新の情報か？

**原則**:
- ✅ **不十分な情報で結論を出さない**
- ✅ **確信が持てるまで調査を続ける**

---

### 対策3: **訂正の明示**

**原則**:
- ✅ 誤りを発見したら、**即座に明示的に認める**
- ✅ 「追加情報」ではなく「訂正」と明言する
- ✅ 訂正の理由を説明する

**今回の失敗**:
- ❌ 「追加情報」のように提示した
- ❌ 「最初の結論は誤りでした」と明言しなかった

---

### 対策4: **ファイル新規作成 vs 修正の明確な基準**

**判断フロー**:
```
1. 既存ファイルに追記可能か？
   YES → 既存ファイル更新
   NO → Step 2へ

2. 新しいトピックか？
   YES → 新規作成
   NO → Step 3へ

3. サイズ制約があるか？
   YES → 分割して新規作成（理由を明示）
   NO → 既存ファイル更新
```

**今回の改善点**:
- ✅ ADR-010の分割理由を明示すべきだった
- ✅ ユーザーに事前確認すべきだった

---

### 対策5: **FILE_UPDATE_CRITERIA.mdの活用**

**作成した基準書**:
- [FILE_UPDATE_CRITERIA.md](file:///C:/Users/kazen/OneDrive/デスクトップ/ai_gogleanti/docs/architecture/FILE_UPDATE_CRITERIA.md)

**活用方法**:
1. ✅ 次回セッション開始時に確認
2. ✅ ファイル更新前に参照
3. ✅ 基準に従って判断

---

## まとめ

### 根本原因（3つ）

1. ✅ **情報探索の範囲が不十分** - usecase-workbook.mdを最初に確認しなかった
2. ✅ **段階的調査の失敗** - 不十分な情報で結論を出した
3. ✅ **訂正の不明示** - 「誤りでした」と明言しなかった

### 対策（5つ）

1. ✅ **徹底的な情報探索** - grep検索、UseCase、Decision Log、ADR確認
2. ✅ **結論を出す前のチェックリスト**
3. ✅ **訂正の明示** - 誤りを即座に認める
4. ✅ **ファイル新規作成 vs 修正の判断フロー**
5. ✅ **FILE_UPDATE_CRITERIA.mdの活用**

### 「古いファイル」の問題ではない

- ❌ SYSTEM_PHILOSOPHY.mdは最新（2026-01-22更新）
- ❌ usecase-workbook.mdも正しい情報
- ✅ **問題は情報探索の範囲が不十分だったこと**

**同じ失敗は繰り返しません。**
