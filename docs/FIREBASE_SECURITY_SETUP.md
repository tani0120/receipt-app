# Firebase Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«è¨­å®šæ‰‹é †

**ä½œæˆæ—¥**: 2026-01-21  
**æœŸé™**: 2026-01-24ï¼ˆ4æ—¥å¾Œï¼‰  
**ç›®çš„**: Firestoreãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰æœŸé™åˆ‡ã‚Œå¯¾å¿œ

---

## âš ï¸ é‡è¦ï¼šæœŸé™ã«ã¤ã„ã¦

**2026-01-24ã¾ã§ã«**ã€Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ãªã„ã¨ã€ã™ã¹ã¦ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ‹’å¦ã•ã‚Œã¾ã™ã€‚

---

## ğŸ“‹ ä½œæ¥­æ‰‹é †

### Step 1: Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ

1. [Firebase Console](https://console.firebase.google.com/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `sugu-suru` ã‚’é¸æŠ
3. **Authentication** â†’ **Users** â†’ **Add user** ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ä»¥ä¸‹ã®æƒ…å ±ã§ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ:
   - Email: `test@example.com`ï¼ˆä»»æ„ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰
   - Password: å¼·åŠ›ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ12æ–‡å­—ä»¥ä¸Šæ¨å¥¨ï¼‰
5. **Add user** ã‚’ã‚¯ãƒªãƒƒã‚¯

---

### Step 2: ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã« `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ:

```bash
# .env.exampleã‚’ã‚³ãƒ”ãƒ¼
cp .env.example .env.local
```

2. `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€Step 1ã§ä½œæˆã—ãŸãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¨­å®š:

```env
VITE_TEST_USER_EMAIL=test@example.com
VITE_TEST_USER_PASSWORD=your-password-here
```

**âš ï¸ æ³¨æ„**: `.env.local` ã¯ `.gitignore` ã«å«ã¾ã‚Œã¦ã„ã‚‹ãŸã‚ã€Gitã«ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã›ã‚“ã€‚

---

### Step 3: Firebase CLIã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# Firebase CLIã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g firebase-tools

# ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
firebase --version
```

---

### Step 4: Firebaseã«ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆåˆå›ã®ã¿ï¼‰

```bash
# Firebaseã«ãƒ­ã‚°ã‚¤ãƒ³
firebase login

# ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã®ã§ã€Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
# ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã‚‹

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–ï¼ˆæ—¢å­˜ã®firebase.jsonã‚’ä½¿ç”¨ï¼‰
firebase use sugu-suru
```

---

### Step 5: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®ã¿ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤
firebase deploy --only firestore:rules

# æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
# âœ”  Deploy complete!
```

---

### Step 6: å‹•ä½œç¢ºèª

1. ã‚¢ãƒ—ãƒªã‚’èµ·å‹•:

```bash
npm run dev
```

2. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ï¼ˆ`http://localhost:5173`ï¼‰

3. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã€ä»¥ä¸‹ã‚’ç¢ºèª:
   - `[testAuth] ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ: test@example.com`

4. Firestoreã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## ğŸ”§ ã‚¢ãƒ—ãƒªã¸ã®çµ±åˆ

### main.tsã«èªè¨¼ãƒ•ãƒ­ãƒ¼ã‚’è¿½åŠ 

`src/main.ts` ã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„:

```typescript
import { signInTestUser } from './utils/testAuth';

// ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
if (import.meta.env.DEV) {
  signInTestUser().catch(error => {
    console.error('ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
  });
}

// æ—¢å­˜ã®ã‚¢ãƒ—ãƒªèµ·å‹•ã‚³ãƒ¼ãƒ‰
createApp(App).mount('#app');
```

---

## ğŸ“Š ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®å†…å®¹

ç¾åœ¨ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ï¼ˆ`firestore.rules`ï¼‰:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ãŒå…¨ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿æ›¸ãå¯èƒ½
    match /clients/{clientId} {
      allow read, write: if request.auth != null;
    }
    match /jobs/{jobId} {
      allow read, write: if request.auth != null;
    }
    // ...ãã®ä»–ã®ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
  }
}
```

**é‡è¦**: èªè¨¼ã•ã‚Œã¦ã„ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ‹’å¦ã•ã‚Œã¾ã™ã€‚

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "Permission denied"

**åŸå› **: ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„ã€ã¾ãŸã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãŒé©ç”¨ã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºç­–**:
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§èªè¨¼çŠ¶æ…‹ã‚’ç¢ºèª:
   ```javascript
   import { getCurrentUser } from './utils/testAuth';
   console.log(getCurrentUser());
   ```
2. ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆã¯ã€`signInTestUser()` ã‚’å®Ÿè¡Œ
3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª:
   ```bash
   firebase deploy --only firestore:rules
   ```

---

### ã‚¨ãƒ©ãƒ¼: "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èªè¨¼æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“"

**åŸå› **: `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„ã€ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºç­–**:
1. `.env.local` ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
2. `VITE_TEST_USER_EMAIL` ã¨ `VITE_TEST_USER_PASSWORD` ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ï¼ˆ`npm run dev` ã‚’å†å®Ÿè¡Œï¼‰

---

### ã‚¨ãƒ©ãƒ¼: "Firebase CLI is not installed"

**åŸå› **: Firebase CLIãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„ã€‚

**è§£æ±ºç­–**:
```bash
npm install -g firebase-tools
```

---

## ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

| æ—¥ä»˜ | ã‚¿ã‚¹ã‚¯ | æ‹…å½“ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
|------|--------|------|----------|
| 2026-01-21 | ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ | å¸ä»¤å®˜ | â³ æœªå®Œäº† |
| 2026-01-21 | .env.localè¨­å®š | å¸ä»¤å®˜ | â³ æœªå®Œäº† |
| 2026-01-22 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ãƒ‡ãƒ—ãƒ­ã‚¤ | å¸ä»¤å®˜ | â³ æœªå®Œäº† |
| 2026-01-23 | å‹•ä½œç¢ºèª | å¸ä»¤å®˜ | â³ æœªå®Œäº† |
| 2026-01-24 | **æœŸé™** | - | - |

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- [Firebase Console - Authentication](https://console.firebase.google.com/project/sugu-suru/authentication/users)
- [Firebase Console - Firestore Rules](https://console.firebase.google.com/project/sugu-suru/firestore/rules)
- [Firebase CLI ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://firebase.google.com/docs/cli)

---

**æœ€çµ‚æ›´æ–°**: 2026-01-21  
**æ¬¡å›ç¢ºèª**: 2026-01-22ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤å¾Œï¼‰
