# 認証システムの完全実装計画

**実施日**: 2026-01-24  
**目的**: ログイン機能を完全に動作させ、セキュリティを確保する

---

## 📋 実装する機能（優先度順）

### 優先度1: Router Guard の実装 🔴

**目的**: ログインしていないユーザーを全ページからブロック

**実装内容**:
1. `router/index.ts` にナビゲーションガードを追加
2. ログインページ以外のすべてのルートを保護
3. 認証状態チェック関数を実装

**ファイル**:
- `src/router/index.ts` - ガード追加
- `src/utils/auth.ts` - 認証状態チェック関数（既存）

**期待される動作**:
- ログインしていない → `/login` にリダイレクト
- ログイン済み → 通常通りアクセス可能

---

### 優先度2: 本番環境の自動ログイン 🟡

**目的**: 本番環境でも開発用の自動ログインを有効化

**現状の問題**:
```typescript
// main.ts
if (import.meta.env.DEV) {  // ← 開発環境のみ
  import('./utils/testAuth').then(({ signInTestUser }) => {
    signInTestUser()...
  });
}
```

**実装内容**:
1. 環境変数 `VITE_AUTO_LOGIN` を追加
2. `main.ts` の条件を変更
3. 本番環境の `.env` に設定

**ファイル**:
- `src/main.ts` - 条件分岐の変更
- `.env.local` - 環境変数追加
- `.env.example` - ドキュメント追加

---

### 優先度3: 手動ログインの修正 🟡

**目的**: ローカル環境での手動ログインを修正

**現状のエラー**:
```
auth/invalid-credential
```

**調査項目**:
1. `LoginView.vue` のログイン処理を確認
2. 入力された認証情報と `.env.local` の値を比較
3. Firebase Authentication のユーザー登録状況を確認

**ファイル**:
- `src/views/LoginView.vue` - ログイン処理
- `src/utils/auth.ts` - 認証関数

---

### 優先度4: バックエンドAPI 🟢

**目的**: バックエンドAPIのエラーを記録（後回し）

**検出されたエラー**:
- `/api/journal-status` → 404
- `/api/conversion` → 500

**対応方針**: Phase 2で対応

---

## 🎯 実装順序

1. ✅ Router Guard 実装（優先度1）
2. ✅ 本番環境の自動ログイン（優先度2）
3. ✅ 手動ログインの修正（優先度3）
4. ⏸️ バックエンドAPI（優先度4 - 後回し）

---

## ✅ 完了条件

- [ ] Router Guard が動作し、未ログイン時に `/login` へリダイレクト
- [ ] ローカル環境で自動ログインが動作
- [ ] 本番環境で自動ログインが動作（環境変数で制御）
- [ ] 手動ログインが正常に動作
- [ ] すべての環境でログイン後にページアク

セス可能

---

**実施開始**: 2026-01-24 18:04
