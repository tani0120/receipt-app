DetectionLogic.ts,26,const exactMatch = historyBalances.find(b => Math.abs(b.closingBalance - detectedStartBalance) < 1);
DetectionLogic.ts,46,const keywordHits = fp.features.keywords.filter(k => text.includes(k)).length;
DetectionLogic.ts,114,const ambiguousKeywords = [
DetectionLogic.ts,179,const duplicate = allItems.find(other =>
DetectionLogic.ts,225,const tDate = new Date(item.transactionDate);
DetectionLogic.ts,279,const transferKeywords = ['振替', '移動', '自分', '資金移動'];
DetectionLogic.ts,297,const isKnown = Array.from(fiscalInfo.knownVendors).some(v => item.description.includes(v));
DetectionLogic.ts,316,const suggestions = [];
ConversionService.ts,16,const ConversionLogDbSchema = z.object({
ConversionService.ts,37,const logId = db.collection(this.COLLECTION).doc().id;
ConversionService.ts,38,const initialLog = {
ConversionService.ts,53,const snippet = fileContent.substring(0, 30000);
ConversionService.ts,55,const prompt = `
ConversionService.ts,72,const responseText = result.response.text();
ConversionService.ts,75,const csvContent = responseText.replace(/```csv/g, '').replace(/```/g, '').trim();
ConversionService.ts,86,return {
ConversionService.ts,105,const snapshot = await db.collection(this.COLLECTION)
GeneralLedgerService.ts,23,const data = await file.arrayBuffer();
GeneralLedgerService.ts,24,const workbook = XLSX.read(data, { type: 'array' }); // xlsx handles encoding usually
GeneralLedgerService.ts,25,const sheetName = workbook.SheetNames[0];
GeneralLedgerService.ts,27,const sheet = workbook.Sheets[sheetName];
GeneralLedgerService.ts,32,const balanceMap = new Map<string, { [month: number]: number }>();
GeneralLedgerService.ts,35,const dateStr = this.parseDate(row['日付']);
GeneralLedgerService.ts,37,const date = new Date(dateStr);
GeneralLedgerService.ts,38,const month = date.getMonth() + 1; // 1-12
GeneralLedgerService.ts,41,const drAmount = Number(row['借方金額'] || 0);
GeneralLedgerService.ts,42,const crAmount = Number(row['貸方金額'] || 0);
GeneralLedgerService.ts,46,const key = this.getAccountKey(row['借方勘定科目'], row['借方補助科目']);
GeneralLedgerService.ts,52,const key = this.getAccountKey(row['貸方勘定科目'], row['貸方補助科目']);
GeneralLedgerService.ts,65,const parts = key.split('::');
GeneralLedgerService.ts,66,const acc = parts[0];
GeneralLedgerService.ts,67,const sub = parts[1];
GeneralLedgerService.ts,88,const batch = writeBatch(db);
GeneralLedgerService.ts,89,const balancesRef = collection(db, 'clients', clientId, 'account_balances');
GeneralLedgerService.ts,94,const safeAccountId = balance.accountId.replace(/[:\/]/g, '_');
GeneralLedgerService.ts,95,const docId = `${balance.fiscalYear}_${String(balance.month).padStart(2, '0')}_${safeAccountId}`;
GeneralLedgerService.ts,96,const docRef = doc(balancesRef, docId);
GeneralLedgerService.ts,108,const d = new Date(Math.round((val - 25569) * 86400 * 1000));
GeneralLedgerService.ts,121,const mData = map.get(key)!;
useJournalEditor.ts,8,const route = useRoute();
useJournalEditor.ts,9,const router = useRouter();
useJournalEditor.ts,10,const id = route.params.id as string;
useJournalEditor.ts,13,const entry = ref<JournalEntry | null>(null);
useJournalEditor.ts,14,const loading = ref(false);
useJournalEditor.ts,15,const isSaving = ref(false);
useJournalEditor.ts,16,const error = ref<Error | null>(null);
useJournalEditor.ts,19,const validation = ref<ValidationResult>({
useJournalEditor.ts,31,const data = await JournalService.fetchJournalById(id);
useJournalEditor.ts,57,const addRow = () => {
useJournalEditor.ts,72,const removeRow = (index: number) => {
useJournalEditor.ts,79,const handleSave = async () => {
useJournalEditor.ts,93,const handleSubmit = async () => {
useJournalEditor.ts,116,const primaryActionButtonLabel = computed(() => {
useJournalEditor.ts,122,return {
