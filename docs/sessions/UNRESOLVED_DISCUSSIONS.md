# 未解決議論・中断した議論（2026-01-21）

**作成日**: 2026-01-21  
**最終更新**: 2026-01-21  
**ステータス**: Active  
**目的**: セッション中に中断・保留した議論を明示的に記録し、次回セッションで再開可能にする

---

## 📋 中断した議論

### 1. 開発用Firebaseプロジェクト作成

**議論の経緯**:
- 本番データ保護のため、開発用Firebaseプロジェクト（`sugu-suru-dev`）作成を提案
- `implementation_plan.md`に詳細な手順を作成
- ユーザーから「本番データがまだないので不要」との判断
- → **中断**

**理由**:
本番データがまだ存在しないため、環境分離の必要性がない

**再開条件**:
- 本番環境に顧問先の実際のデータが追加されたとき
- 機密情報（領収書等）を扱い始めたとき

**記録先**:
- `brain/implementation_plan.md`（セッション固有）
- → 削除または「不要と判断」を明記して保持

**次のアクション**:
- 本番データ追加時に再検討
- 必要になったら、`implementation_plan.md`を参照して実施

---

### 2. バックエンドアーキテクチャ実装計画

**議論の経緯**:
- 当初「Firestore直接アクセスで問題ない」と判断
- ユーザーから以下の指摘：
  - AI処理が必要（Gemini API呼び出し）
  - 複雑な集計処理が必要
  - バッチ処理が必要
  - 機密情報を扱う（顧問先の領収書等）
- SYSTEM_PHILOSOPHY.mdを確認：
  - **GAS (Google Apps Script)**: Google Driveファイル操作 + AI解析バッチ + ファイル移動
  - **現状**: VueアプリのMock/Service層でシミュレーション中
- → **結論**: GASが必要だが、実装計画は未定

**問題点**:
- GASをいつ、どのように実装するか未定義
- `src/server.ts`、`src/api/`の扱いが曖昧（Mockなのか、本番用なのか）

**再開条件**:
- AI解析バッチ実装が必要になったとき
- Google Driveのファイル操作が必要になったとき

**記録先**:
- SYSTEM_PHILOSOPHY.md（GASの役割は既に明記済み）
- 実装計画: 将来作成すべき

**次のアクション**:
- ADR-008: バックエンドアーキテクチャ戦略（GAS vs Node.js）を作成すべきか検討
- または、TASK_MASTER.mdに「GAS実装」タスクを追加

---

## 📋 保留した判断

### 3. セッション管理プロトコル改善

**議論の経緯**:
- セッション開始・終了のファイル更新にブレがある問題を指摘
- 改善案A/B/Cを提示：
  - **改善案A（推奨）**: 最小セット + 段階的拡張
  - **改善案B（保守的）**: 完全チェックリスト方式
  - **改善案C**: ハ イブリッド方式
- → **承認待ち**

**提案ドキュメント**:
- `brain/session-protocol-improvement.md`（作成済み）

**問題点**:
- 承認されていないため、まだ適用されていない
- 今回のセッション終了時にどのプロトコルで進めるか未定

**再開条件**:
- ユーザー承認後

**次のアクション**:
- 次回セッション開始時に再確認
- 承認されたら、session-management-protocol-complete.mdを更新

---

## 📋 ADR作成検討（結論: 不要）

### Firebase認証戦略

**議論**:
ADR-008: Firebase認証戦略を作成すべきか？

**判定**:
```
判定チェック:
- アーキテクチャの根本的変更？
  → No（認証層追加だが、既存アーキテクチャの延長）
  
- 開発原則の確立？
  → No（既存の原則に従っているだけ）
  
- 技術選定の重要判断？
  → Yes（Firebase Authを採用）
  → しかし、Firebaseは既に採用済み（Firestore使用中）
  → 追加機能の利用なので、ADRレベルではない
  
結論: SYSTEM_PHILOSOPHY.mdに記録（ADR不要）
```

**対応**:
- SYSTEM_PHILOSOPHY.md + CHANGELOG_SYSTEM_PHILOSOPHY.mdに記録
- ADR作成は不要

---

## ✅ 解決済み（Resolved）

### #3. セッション管理プロトコル改善

**記録日**: 2026-01-21  
**解決日**: 2026-01-21  
**優先度**: 中

**内容**: セッション管理プロトコルの実効性向上

**解決方法**:
- session-management-protocol-complete.mdを更新
- セッション開始プロトコルにUNRESOLVED_DISCUSSIONS.md確認を追加
- セッション終了プロトコルに未解決議論の確認を追加

**成果物**:
- session-management-protocol-complete.md（更新版）
- SESSION_CHECKLIST.md（新規作成）

---

### #4. セッション開始プロトコル修正

**記録日**: 2026-01-21  
**解決日**: 2026-01-21  
**優先度**: 中

**内容**: SESSION_CHECKLIST.md作成が抜けていた

**解決方法**:
- session-management-protocol-complete.mdのステップ1にSESSION_CHECKLIST.md作成を追加

**成果物**:
- session-management-protocol-complete.md（修正版）

---

### #5. 小さく開発への方針転換

**記録日**: 2026-01-22  
**解決日**: 2026-01-22  
**優先度**: 高

**内容**: Penta-Shield（L4/L5）とLayer A/B/Cは過剰設計だった

**解決方法**:
1. ✅ 既存コード動作確認テスト実施（6項目）
   - テスト結果: パターンA（完全動作） ✅✅✅✅✅✅
   - 判定: 選択肢B（そのまま使う）を採用
2. ✅ ADR-009作成（シンプルアーキテクチャへの回帰）
   - テスト内容、3つの選択肢、選択理由を詳細に記録
3. ✅ ADR-004/005/006/008のStatusを「Superseded by ADR-009」に更新
4. ✅ READING_INDEX.mdにADR-009追加

**今後の方針**:
- 既存コード（Receipt, Client, Job, Staff）: そのまま使う
- 新機能（仕訳入力等）: シンプル版（3層構成）で実装
- L4/L5: 永久に不採用
- Layer A/B/C: 永久に不採用

**成果物**:
- ADR-009-simple-architecture.md
- ADR-004/005/006/008（Status更新）
- READING_INDEX.md（更新）
- investigateExistingCode.ts（テスト実施後削除）

---

### #6. 開発の優先順序（AI API vs L1-3定義）

**記録日**: 2026-01-22  
**解決日**: 2026-01-22  
**優先度**: 高

**内容**: 開発の順序（AI API実装 vs L1-3定義）

**議論の経緯**:
- AI API実装を先にすべきか？
- L1-3定義を先にすべきか？
- ユーザーの指摘:「人間が必要とするプロパティやスキーマにAIを合わせさせるためにL1-3があるのでは？」

**誤ったアプローチ**:
1. ❌ AI API実装（先）→ AIの出力形式に合わせる
2. ❌ L1-3定義（後）→ AIの出力に合わせてスキーマを作る

**問題点**:
- AIが主、人間が従になる
- AIの出力形式に振り回される
- L1-3の本質（人間が定義する防御層）を無視

**正しいアプローチ**:
1. ✅ **L1-3定義（先）** → 人間が必要とするデータ構造を決める
2. ✅ **AI API実装（後）** → L1（Zodスキーマ）に合わせてAIの出力を整形

**原則**:
- **人間が主、AIが従**
- L1（Zodスキーマ）が真実の情報源
- AIはL1に従って出力を整形する

**決定した順序**:
1. MVP定義（1-2時間）
2. **L1-3定義**（3-4時間） - 人間が主導
3. **AI API実装**（2-3時間） - L1に従う
4. UIモック（4-6時間）

**成果物**:
- 開発順序の明確化（次回セッションから適用）



## 更新履歴

- **2026-01-22 21:22**: 6件目追加（開発の優先順序：人間が主、AIが従）
- **2026-01-22 00:26**: 5件目追加（小さく開発への方針転換）
- **2026-01-21 23:40**: 4件目を解決済みに更新（セッション開始プロトコル修正完了）
- **2026-01-21 23:33**: 4件目追加（セッション開始プロトコル修正未完了）
- **2026-01-21**: 初版作成（Firebase認証設定セッション）


1. **必須**: ADR-005, ADR-006を読む（1時間）
2. **必須**: ADR-008作成（1時間）
3. **必須**: implementation_plan.md作成（2時間）
4. **推奨**: UseCaseの絞り込み（207件 → 10件程度）
5. **推奨**: Mapping Tableテンプレート作成

**優先度**: **高**（Phase 3-Bの代わりに実施）

**次回対応**: ✅ **次回セッションで対応予定**（2026-01-22承認）

**議論の重要性**:
- L4/L5の本質理解（「意味と画面の束縛」「意味の不変性保証」）
- 過去の失敗（表示されない、デバッグ不能）の根本原因理解
- Layer A/B/Cの組み合わせによる段階的実装戦略

---
