# Q1-Q2完了報告 & 残タスク整理

**日付**: 2026-01-15  
**ステータス**: Q2完了、次のアクション確認中

---

## ✅ 完了したタスク

### **Q1: スキーマ統合**
- ClientSchemaに新規フィールド9個追加
- defaultPaymentMethod修正
- マイグレーション実装

### **Q2: 会計ソフト**
- TKCを追加：`['yayoi', 'freee', 'mf', 'tkc', 'other']`

---

## 📋 残りの確認事項（Q3-Q9）

### **Q3: 担当者マスタ**
**質問**: 担当者一覧はどこから取得？
- A: Firestoreに`staffs`コレクションがある
- B: 固定リスト（ハードコード）
- C: その他

**影響**: フォームのドロップダウン実装方法

---

### **Q4: フォームUI構造**
**質問**: 基本情報/会計設定/報酬設定の配置は？
- A: タブ形式
- B: アコーディオン
- C: 縦スクロール1画面

**質問**: フォームの表示方法は？
- A: モーダル
- B: サイドパネル
- C: 別ページ

---

### **Q5: 一覧画面の表示項目**
**確認**: 報酬情報は一覧に表示する？
- 一覧画面：設定状況、ID、会社名、担当、連絡、決算月、ソフト/税/基準、DRIVE連携
- 報酬情報：顧問報酬、記帳代行、決算報酬、消費税申告報酬

**影響**: `ClientUiSchema`の設計

---

### **Q6: Drive連携フィールド**
**質問**: フォルダIDはこのフォームで編集可能？
- A: 可能（フォーム内で入力）
- B: 不可（別の管理画面で設定）
- C: 読み取り専用（表示のみ）

**影響**: フォームのフィールド設計

---

### **Q7: 自動算出フィールドの保存**
**決定済み**: 保存しない（Mapperで算出）
- 月次報酬合計 = 顧問報酬 + 記帳代行
- 年間総報酬 = 計算式により算出

**対応**: Mapper実装時に算出ロジックを追加

---

### **Q8: バリデーション詳細**

#### **3コード重複チェック**
**実装方針**:
```typescript
const clientCodeValidator = z.string()
  .length(3)
  .regex(/^[A-Z]{3}$/)
  .refine(async (code, ctx) => {
    if (ctx.isEditing) return true;
    return !await checkClientCodeExists(code);
  }, '既に登録されているコードです');
```

**質問**: 実装タイミングは？
- A: 今すぐ（Q8で実装）
- B: フォームUI実装時

#### **設立年月日の範囲**
**質問**: 制限は？
- A: 1900年以降のみ
- B: 過去のみ（未来不可）
- C: 制限なし

---

### **Q9: マイグレーション**
**質問**: 既存データへの対応は？
- A: 手動で再入力（少数のテストデータのみ）
- B: スクリプトで一括設定（デフォルト値0等）
- C: UI上で「未設定」として入力を促す

---

## 🎯 推奨する進め方

### **パターンA: 全て確認してから実装（保守的）**
1. Q3-Q9全ての回答を受領
2. データ契約を完全に確定
3. 一気に実装

**メリット**: 手戻りなし  
**デメリット**: 時間がかかる

---

### **パターンB: 段階的に確認・実装（効率的、推奨）**
1. Q3確認 → 担当者マスタ対応
2. Q4-Q6確認 → UI設計確定
3. Q8実装 → バリデーション
4. フォーム実装

**メリット**: 段階的に進められる  
**デメリット**: なし

---

## 次のアクション

**どれを選びますか？**

1. **パターンA**: Q3-Q9全てに回答してから実装開始
2. **パターンB**: Q3から順番に確認・実装
3. **その他**: 別のアプローチ

---

**回答をお待ちしています。**
