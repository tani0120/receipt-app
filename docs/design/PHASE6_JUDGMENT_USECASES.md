# Phase 6 / Step 1: 判断UseCase 棚卸し

**作成日:** 2026-01-13  
**Phase:** 6（判断・最適化）  
**Step:** 1（設計のみ・コードなし）

---

## 目的

**Phase 6に入る前に:**
「このシステムに存在する"判断"をすべて露出させる」

> **重要:** まだ I/O スキーマもコードも作らない

---

## 判断分類の軸（固定）

### 1. 判断主体

- **人（Human）**
- **AI**
- **ルール（Rule / Deterministic）**
- **システム（単純条件分岐）**

### 2. 判断の種類

- 承認 / 却下
- 推論
- 最適化
- 優先度付け
- 提案生成
- 集計解釈

### 3. 出力の性質

- 状態変更
- 提案（非確定）
- スコア / confidence
- 理由 / 根拠
- 候補集合
- 並び順

---

## Phase 6 判断UseCase 一覧（10個）

### 1. ConfirmJournal（仕訳確定）

**判断主体:** 人  
**判断の種類:** 承認判断  
**判断内容:** この仕訳を「確定」してよいか

**出力:**
- `status = confirmed`

**備考:**
判断理由は人間の頭の中（記録するかは Phase 6 で検討）

---

### 2. RemandJournal（仕訳差戻し）

**判断主体:** 人  
**判断の種類:** 差戻し判断  
**判断内容:** 修正が必要か

**出力:**
- `status = remanded`

**備考:**
理由入力UIの有無は Phase 6 UX 判断

---

### 3. ExcludeJournal（仕訳除外）

**判断主体:** 人  
**判断の種類:** 除外判断  
**判断内容:** 会計対象から外すか

**出力:**
- `status = excluded`

**備考:**
Phase 4.5では扱えなかった状態変更系

---

### 4. DetectBank（銀行検知）

**判断主体:** AI  
**判断の種類:** 推論  
**判断内容:** どの銀行かを推測

**出力:**
- `detectedBank` (proposal)
- `confidence`
- `reasons`
- `alternatives`

**備考:**
- 決定しない
- 人間が採用するかを判断
- Phase 4.5では除外された（DEFERRED_USECASES.md記録済み）

---

### 5. AllocateJob（ジョブ配分）

**判断主体:** ルール / AI（将来）  
**判断の種類:** 最適化  
**判断内容:** 金額・行をどう割り当てるか

**出力:**
- `allocation proposal`

**備考:**
正解は存在しない前提

---

### 6. ApplyAIProposal（AI提案適用）

**判断主体:** 人  
**判断の種類:** 採用判断  
**判断内容:** AI提案を適用するか

**出力:**
- 採用 / 非採用

**備考:**
Phase 6で重要な「人が最後に決める箱」

---

### 7. ApplyLearningRules（学習ルール適用）

**判断主体:** ルール  
**判断の種類:** 推論＋適用判断  
**判断内容:** 過去ルールを今回に使うか

**出力:**
- 適用候補 + confidence

**備考:**
AIルールの自動適用判断

---

### 8. ConvertAccountingData（会計データ変換）

**判断主体:** ルール  
**判断の種類:** 変換戦略選択  
**判断内容:** どの変換ルールを使うか

**出力:**
- 変換結果 + 使用ルールID

**備考:**
Phase 4.5のExport/Import（判断なし）とは異なる

---

### 9. FetchDashboardMetrics（ダッシュボード指標）

**判断主体:** システム  
**判断の種類:** 集計解釈  
**判断内容:** 何を重要指標として出すか

**出力:**
- 指標集合
- 並び順

**備考:**
ここでUX判断が混入しやすい

---

### 10. レスポンシブ表示判断（UI）

**判断主体:** システム / UX設計  
**判断の種類:** 優先度付け  
**判断内容:** モバイルで何を省略するか

**出力:**
- 表示項目セット

**備考:**
Phase 6で初めて解禁

---

## Phase 6の原則（Phase 4.5との対比）

### Phase 4.5の原則
- ❌ 判断を含む箱は存在してはいけない
- ❌ confidence / reasons は毒
- ❌ 推論は密輸される
- **→ 沈黙が正義**

### Phase 6の原則
- ✅ 判断を隠さない
- ✅ confidence / reasons / alternatives は 必須
- ✅ 出力は「決定」ではなく「提案」
- **→ 露出が正義**

---

## 重要な確認（思想固定）

**Phase 6のUseCaseは:**
- すべて判断を含む
- 判断は: 隠さない、決定しない、理由を持つ
- Phase 4.5の原則は ここでは適用しない

---

## 次のStep（まだやらない）

**Step 2以降で実施:**
1. 各判断UseCaseの I/O スキーマ定義
2. confidence / reasons の共通構造設計
3. UI への漏れ方設計

**現時点:**
- コードは一切書かない
- スキーマも作らない
- 判断の存在を露出させるのみ

---

## 判断分類表（サマリー）

| UseCase | 判断主体 | 判断の種類 | 出力 |
|---------|---------|-----------|------|
| ConfirmJournal | 人 | 承認判断 | 状態 |
| RemandJournal | 人 | 差戻し判断 | 状態 |
| ExcludeJournal | 人 | 除外判断 | 状態 |
| DetectBank | AI | 推論 | confidence + reasons |
| AllocateJob | ルール / AI | 最適化 | 配分結果 |
| ApplyAIProposal | 人 | 採用判断 | 採用/非採用 |
| ApplyLearningRules | ルール | 推論＋適用 | 候補 + confidence |
| ConvertAccountingData | ルール | 変換戦略 | 結果 + ルールID |
| FetchDashboardMetrics | システム | 集計解釈 | 指標集合 + 順序 |
| レスポンシブ表示 | システム / UX | 優先度付け | 表示項目セット |

---

**Phase 6 / Step 1 完了条件:**
このドキュメントの承認

---

## 承認記録

- **Phase:** 6
- **Step:** 1
- **内容:** 判断UseCase棚卸し（設計のみ）
- **状態:** 承認済
- **承認日:** 2026-01-13

**承認の意味:**
本ドキュメントをもって、Phase 6 における「判断を含むUseCase」の存在と範囲を確定する。  
以降、Phase 4.5 の原則は本一覧には適用しない。

