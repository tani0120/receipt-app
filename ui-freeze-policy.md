# UI Freeze Policy: Ironclad Protocols

## 0. 本文書の位置づけ（最重要）

本書は UI 開発における Freeze（凍結）状態を定義する契約文書である。
本書に違反した UI は、いかなる理由があっても Freeze 完了とは認められない。

以下を原則とする。
*   **本書に明記されていない行為は 原則禁止**
*   **「実害がない」「結果的に問題が出なかった」は 一切考慮しない**
*   **証跡（スクリーンショット・README）が存在しない場合、作業は未実施とみなす**
*   **事後対応・事後撮影・事後説明は すべて無効**

## 1. 最終到達状態（Freeze 定義）

Freeze とは、以下すべてが **不可逆的に確定した状態**を指す。

| 項目 | 状態 |
| :--- | :--- |
| UI構造 | 確定 |
| 表示仕様 | 確定 |
| データ契約（Contract） | 確定 |
| 防御方針 | 確定 |
| 視覚証跡 | 保存済 |
| README | 作成済 |

**上記のいずれかが欠けている場合、Freeze は 成立していない。**

## 2. フェーズ構成（厳守）

UI 開発は、必ず以下の順序で実施する。

1.  **Phase A：Visual Truth（見た目確定）**
2.  **Phase B：Non-Destructive Refactor（構造整理）**
3.  **Phase C：Ironclad Contract（契約確定）**
4.  **Freeze（状態）**

## 3. Phase 越境禁止ルール（絶対）

以下の行為は **即時失格**とする。
*   Phase A 中に Phase B / C の作業を行うこと
*   Phase B 中に Phase A の見た目を再解釈・調整すること
*   Phase C 中に UI / レイアウト / 表示仕様へ手を触れること

違反が確認された場合：
*   **該当 Phase は 失敗**
*   **該当 Phase は 最初からやり直し**
*   **Freeze には 進めない**

## 4. Phase A：Visual Truth（見た目確定）

### 4.1 目的
正解画像と 1px も違わない UI を確定させること
Phase A において考慮してよいものは **正解画像のみ**である。

### 4.2 絶対原則
*   正解画像（Figma / PNG / PDF）が **唯一の真実**
*   将来要件・拡張性・レスポンシブは **一切考慮しない**
*   世界線は **指定解像度のみ**（例：1280px）

### 4.3 許可される実装
*   Tailwind / CSS のテンプレート直書き
*   コピペ・重複・冗長クラス
*   ハードコードされた仮データ
*   ダミー値・固定値

### 4.4 禁止事項
*   コンポーネント分割
*   クラス共通化
*   再利用設計
*   条件分岐の実装
*   「後で直す前提」の調整

### 4.5 完了条件（Yes / No）
以下すべてを満たすこと。
*   正解画像との Overlay 比較で **ズレ 0px**
*   Phase A 必須スクリーンショットが **すべて存在**
*   差分が 1px でも確認された場合 → **未完**

## 5. Phase B：Non-Destructive Refactor（構造整理）

### 5.1 着手条件（前提）
以下が **すべて存在しない限り**、Phase B に入ってはならない。
*   Phase A 完了スクリーンショット
*   Golden UI（正解 UI）
*   Overlay 比較手段

### 5.2 目的
見た目を 1px も変えずに、構造のみを整理すること

### 5.3 絶対ルール
*   Visual Regression = **0px**
*   見た目が変わった時点で **即失敗**

### 5.4 許可される行為
*   Dumb Component への切り出し
*   表示責務の明確化
*   スタイルの局所カプセル化
*   完全に同一な UI パターンのみの共通化

### 5.5 「同一 UI パターン」の定義（全条件必須）
*   見た目が完全一致
*   表示責務が完全一致
*   状態数が一致
*   将来の仕様分岐が **発生しないことが確定**

※ 1 つでも満たさない場合、共通化は禁止

### 5.6 禁止事項
*   レイアウト変更
*   クラス整理による見た目影響
*   表示仕様の再解釈
*   ついでの最適化

### 5.7 完了条件
*   Before / After Overlay 比較で **差分 0px**
*   Phase B 必須スクリーンショットが **すべて存在**

## 6. Phase C：Ironclad Contract（契約確定）

### 6.1 目的
どんなデータが来ても UI を白くしないことを、契約と証跡で保証する

### 6.2 Phase C 禁止事項（絶対）
*   UI 側への fallback ロジック追加
*   Mapper の返却型拡張
*   optional の追加
*   「念のため」の null / undefined チェックを UI に書くこと

### 6.3 必須要件
*   UI 型（Contract）は **変更禁止**
*   Mapper は unknown 入力を受け、完全充填した UI 型のみを返す
*   Mapper は `throw` しない
*   UI は `if` を書かない

### 6.4 ストレステスト
Phase C では、定義された最強レベルのストレステストを必須とする。
詳細仕様は `ui-freeze-appendix-a.md` に従うこと。

### 6.5 完了条件
以下すべてが Yes の場合のみ Phase C 完了とする。
*   Mapper が例外を投げない
*   UI が白くならない
*   Contract が TypeScript により破壊不能
*   レイアウト破壊なし
*   コンソールエラー 0
*   Phase C 必須スクリーンショットが **すべて存在**

## 7. Freeze（凍結）

### 7.1 Freeze 成立条件（全必須）
*   Phase A 完了
*   Phase B 完了
*   Phase C 完了
*   全証跡保存済
*   README 作成済

### 7.2 Freeze 解除条件（例外）
以下のいずれか **のみ許可する**。
*   正解画像の変更
*   仕様書に明示的な表示変更指示
*   新 Version としての再開発合意

※ 「違和感」「改善したい」は理由にならない

## 8. 違反時の扱い
*   Freeze 宣言は **無効**
*   該当フェーズは **未実施扱い**
*   再検証・再撮影が必要

## 9. 本書の優先順位
*   本書は、口頭説明・慣習・一般論に **常に優先する**
*   Appendix は **補足**であり、本文を上書きしない
