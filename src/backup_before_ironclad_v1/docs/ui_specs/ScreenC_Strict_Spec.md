# ScreenC UI設計書 v1.0 - 完全再現定義 (UI+Logic+Style)

Source: ScreenC_CollectionStatus.vue
Generated: 2025-12-28T07:42:35.065Z


## UI Definition (Template)
1. [UI_Structure] Line:2 <div> Class = "h-full flex flex-col bg-white rounded-lg shadow border border-gray-200 overflow-hidden animate-fade-in relative"
2. [UI_Structure] Line:4 <div> Class = "h-full flex flex-col bg-slate-50 overflow-hidden animate-fade-in relative w-full"
3. [UI_Structure] Line:5 <div> Class = "p-6 max-w-7xl mx-auto w-full overflow-y-auto"
4. [UI_Structure] Line:6 <button> Class = "text-xs text-gray-500 hover:text-blue-500 mb-4 flex items-center"
5. [UI_Logic] Line:6 <button> Binding: click = "goBack"
6. [UI_Structure] Line:7 <i> Class = "fa-solid fa-arrow-left mr-1"
7. [UI_Structure] Line:10 <div> Class = "bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6 flex justify-between items-start"
8. [UI_Structure] Line:12 <div> Class = "flex items-center gap-3 mb-2"
9. [UI_Structure] Line:13 <span> Class = "bg-slate-100 text-slate-600 text-sm px-2 py-1 rounded font-mono font-bold"
10. [UI_Content] Line:13 Text = "{{ currentClient.code }}"
11. [UI_Structure] Line:14 <h1> Class = "text-2xl font-bold text-slate-800"
12. [UI_Content] Line:14 Text = "{{ currentClient.name }}"
13. [UI_Structure] Line:15 <span> Class = "text-xs bg-slate-100 px-2 py-1 rounded border text-slate-500"
14. [UI_Structure] Line:19 <div> Class = "flex items-center gap-3 bg-blue-50 px-4 py-2 rounded-full border border-blue-100 inline-flex"
15. [UI_Structure] Line:20 <i> Class = "fa-solid fa-calendar-check text-blue-500"
16. [UI_Structure] Line:21 <span> Class = "text-sm text-blue-800 font-bold"
17. [UI_Content] Line:21 Text = "第 5 期 ({{ viewYearStart }}/04 〜 {{ viewYearStart + 1 }}/03)"
18. [UI_Structure] Line:22 <span> Class = "text-xs text-blue-400 border-l border-blue-200 pl-3"
19. [UI_Content] Line:22 Text = "現在 8ヶ月目"
20. [UI_Structure] Line:25 <div> Class = "flex flex-col items-end gap-2"
21. [UI_Structure] Line:26 <button> Class = "bg-slate-700 text-white px-4 py-2 rounded text-sm font-bold hover:bg-slate-800 shadow-sm flex items-center gap-2"
22. [UI_Logic] Line:26 <button> Binding: click = "openReportModal"
23. [UI_Structure] Line:27 <i> Class = "fa-regular fa-copy"
24. [UI_Structure] Line:29 <p> Class = "text-[10px] text-gray-400"
25. [UI_Content] Line:29 Text = "設定に基づきリアルタイム生成します"
26. [UI_Structure] Line:33 <div> Class = "grid grid-cols-1 lg:grid-cols-3 gap-6"
27. [UI_Structure] Line:34 <div> Class = "lg:col-span-2 grid grid-cols-2 gap-4"
28. [UI_Structure] Line:36 <div> Class = "flex flex-col justify-between p-4 rounded-lg border shadow-sm h-36 relative transition bg-green-50 border-green-200 text-green-800"
29. [UI_Structure] Line:37 <div> Class = "space-y-1"
30. [UI_Structure] Line:38 <div> Class = "font-bold text-sm flex items-center gap-2"
31. [UI_Structure] Line:39 <i> Class = "fa-solid fa-receipt"
32. [UI_Structure] Line:41 <div> Class = "text-xs"
33. [UI_Structure] Line:41 <span> Class = "font-bold"
34. [UI_Content] Line:41 Text = "最新受領日:"
35. [UI_Structure] Line:43 <div> Class = "flex justify-between items-end border-t border-green-100 pt-2"
36. [UI_Structure] Line:44 <span> Class = "text-xs text-green-600 font-bold"
37. [UI_Structure] Line:44 <i> Class = "fa-solid fa-check"
38. [UI_Content] Line:44 Text = "順調"
39. [UI_Logic] Line:49 <template> Binding: key = "bank.id"
40. [UI_Structure] Line:50 <div> Class = "["
41. [UI_Logic] Line:50 <div> Binding: class = "['flex flex-col justify-between p-4 rounded-lg border shadow-sm h-36 relative transition', bank.status === 'connected' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800']"
42. [UI_Structure] Line:51 <button> Class = "absolute top-2 right-2 text-gray-400 hover:text-red-500 transition"
43. [UI_Structure] Line:52 <i> Class = "fa-solid fa-trash text-xs"
44. [UI_Structure] Line:54 <div> Class = "space-y-1 pr-4"
45. [UI_Structure] Line:55 <div> Class = "font-bold text-sm truncate flex flex-wrap gap-x-2 items-baseline"
46. [UI_Structure] Line:56 <span> Class = "text-xs text-slate-500"
47. [UI_Structure] Line:56 <i> Class = "fa-solid fa-building-columns"
48. [UI_Content] Line:57 Text = "{{ bank.bankName }}"
49. [UI_Structure] Line:58 <span> Class = "text-xs font-normal"
50. [UI_Content] Line:58 Text = "{{ bank.branchName }}"
51. [UI_Structure] Line:59 <span> Class = "text-xs font-mono bg-white/50 px-1 rounded"
52. [UI_Content] Line:59 Text = "{{ maskNumber(bank.accountNumber) }}"
53. [UI_Structure] Line:61 <div> Class = "text-xs mt-2"
54. [UI_Structure] Line:61 <span> Class = "font-bold"
55. [UI_Content] Line:61 Text = "受領期間:"
56. [UI_Structure] Line:63 <div> Class = "flex justify-between items-end border-t pt-2"
57. [UI_Logic] Line:63 <div> Binding: class = "bank.status === 'connected' ? 'border-green-100' : 'border-red-100'"
58. [UI_Structure] Line:64 <span> Class = "text-xs text-green-600 font-bold"
59. [UI_Structure] Line:64 <i> Class = "fa-solid fa-check"
60. [UI_Content] Line:64 Text = "連携OK"
61. [UI_Structure] Line:65 <span> Class = "text-xs text-red-600 font-bold"
62. [UI_Structure] Line:65 <i> Class = "fa-solid fa-triangle-exclamation"
63. [UI_Content] Line:65 Text = "エラー"
64. [UI_Structure] Line:66 <span> Class = "text-xs text-gray-400 font-bold"
65. [UI_Content] Line:66 Text = "手動"

## Logic Definition (Script)
66. [Internal_Import_Dependency] Line:387 Code = "import { ref, reactive, computed, inject, watch, onMounted } from 'vue';"
67. [Internal_Import_Dependency] Line:388 Code = "import { useRoute, useRouter } from 'vue-router';"
68. [Internal_Import_Dependency] Line:389 Code = "import { useAccountingSystem } from '@/composables/useAccountingSystem';"
69. [Internal_Import_Dependency] Line:390 Code = "import { FirestoreRepository } from '@/services/firestoreRepository';"
70. [Internal_Import_Dependency] Line:391 Code = "import type { Client, BankAccount, CreditCard } from '@/types/firestore';"
71. [Internal_Import_Dependency] Line:392 Code = "import moment from 'moment';"
72. [Internal_Logic_Flow] Line:394 Code = "const route = useRoute();"
73. [Internal_Logic_Flow] Line:395 Code = "const router = useRouter();"
74. [Internal_Logic_Flow] Line:396 Code = "const { clients, fetchClients, subscribeToClientJobs, jobs, checkMaterialStatus, unsubscribeFromJobs } = useAccountingSystem();"
75. [Internal_Logic_Flow] Line:398 Code = "onMounted(() => { fetchClients(); });"
157. [Logic_Refinement] CSS Class `bg-diagonal` logic:
    - Cells inactive relative to fiscal terms (5-year window) must have `bg-diagonal`.
    - Active Period 1: `bg-white` (Current fiscal year range relative to cell date).
    - Active Period 2: `bg-blue-50` (Next fiscal year range).
    - Pattern: `linear-gradient(45deg, ...)` 8px size.
158. [Logic_Refinement] Fiscal Month Bar:
    - If `isFiscalMonth(m)` is true: Show `border-r-2 border-blue-500` and `span` with text "決".
159. [Logic_Refinement] Icons:
    - Only show if `shouldShowIcon(m)` is true (Active period + Not Future).
    - Status 0: `fa-xmark text-red-500`
    - Status 1: `fa-circle-check text-green-500`
    - Status 2: `fa-triangle-exclamation text-yellow-500`const showToast = inject<any>('showToast');"
79. [Internal_Logic_Flow] Line:408 Code = "const fetchedBanks = ref<BankAccount[]>([]);"
80. [Internal_Logic_Flow] Line:409 Code = "const fetchedCards = ref<CreditCard[]>([]);"
81. [Internal_State_Definition] Line:410 Code = "const isAssetsLoading = ref(false);"
82. [Internal_Logic_Flow] Line:412 Code = "const fetchAssets = async (clientCode: string) => {"
83. [Internal_Logic_Flow] Line:413 Code = "isAssetsLoading.value = true;"
84. [Internal_Logic_Flow] Line:414 Code = "try {"
85. [Internal_Logic_Flow] Line:415 Code = "const [banks, cards] = await Promise.all(["
86. [Internal_Logic_Flow] Line:416 Code = "FirestoreRepository.getBankAccounts(clientCode),"
87. [Internal_Logic_Flow] Line:417 Code = "FirestoreRepository.getCreditCards(clientCode)"
88. [Internal_Logic_Flow] Line:418 Code = "]);"
89. [Internal_Logic_Flow] Line:419 Code = "fetchedBanks.value = banks;"
90. [Internal_Logic_Flow] Line:420 Code = "fetchedCards.value = cards;"
91. [Internal_Logic_Flow] Line:421 Code = "} catch (e) {"
92. [Internal_Logic_Flow] Line:422 Code = "console.error('Failed to fetch assets', e);"
93. [Internal_Logic_Flow] Line:423 Code = "} finally {"
94. [Internal_Logic_Flow] Line:424 Code = "isAssetsLoading.value = false;"
95. [Internal_Logic_Flow] Line:425 Code = "}"
96. [Internal_Logic_Flow] Line:426 Code = "};"
97. [Internal_Computed_Logic] Line:431 Code = "const isDetailView = computed(() => !!route.params.code);"
98. [Internal_Computed_Logic] Line:433 Code = "const currentClient = computed(() => {"
99. [Internal_Logic_Flow] Line:434 Code = "if (!isDetailView.value) return null;"
100. [Internal_Logic_Flow] Line:440 Code = "const found = clients.value.find((c: Client) => c.clientCode === route.params.code);"
101. [Internal_Logic_Flow] Line:442 Code = "if (!found) return null;"
102. [Internal_Logic_Flow] Line:445 Code = "return {"
103. [Internal_Logic_Flow] Line:446 Code = "...found,"
104. [Internal_Logic_Flow] Line:447 Code = "code: found.clientCode,"
105. [Internal_Logic_Flow] Line:448 Code = "name: found.companyName,"
106. [Internal_Logic_Flow] Line:456 Code = "type: 'corp',"
107. [Internal_Logic_Flow] Line:459 Code = "banks: fetchedBanks.value,"
108. [Internal_Logic_Flow] Line:460 Code = "creditCards: fetchedCards.value,"
109. [Internal_Logic_Flow] Line:463 Code = "jobId: found.clientCode"
110. [Internal_Logic_Flow] Line:464 Code = "};"
111. [Internal_Logic_Flow] Line:465 Code = "});"
112. [Internal_Computed_Logic] Line:468 Code = "const materialStatuses = computed(() => {"
113. [Internal_Logic_Flow] Line:469 Code = "if (!currentClient.value) return [];"
114. [Internal_Logic_Flow] Line:472 Code = "const found = clients.value.find((c: Client) => c.clientCode === route.params.code);"
115. [Internal_Logic_Flow] Line:473 Code = "if (!found) return [];"
116. [Internal_Logic_Flow] Line:475 Code = "return checkMaterialStatus(found, jobs.value);"
117. [Internal_Logic_Flow] Line:476 Code = "});"
118. [Internal_Logic_Flow] Line:479 Code = "watch(() => route.params.code, async (newCode) => {"
119. [Internal_Logic_Flow] Line:480 Code = "if (newCode && typeof newCode === 'string') {"
120. [Internal_Logic_Flow] Line:481 Code = "await fetchAssets(newCode);"
121. [Internal_Logic_Flow] Line:482 Code = "subscribeToClientJobs(newCode); // Subscribe to jobs for status check"
122. [Internal_Logic_Flow] Line:483 Code = "} else {"
123. [Internal_Logic_Flow] Line:484 Code = "fetchedBanks.value = [];"
124. [Internal_Logic_Flow] Line:485 Code = "fetchedCards.value = [];"
125. [Internal_Logic_Flow] Line:486 Code = "}"
126. [Internal_Logic_Flow] Line:487 Code = "}, { immediate: true });"
127. [Internal_Logic_Flow] Line:491 Code = "const maskNumber = (num: string) => {"
128. [Internal_Logic_Flow] Line:492 Code = "if (!num || num.length < 4) return num;"
129. [Internal_Logic_Flow] Line:493 Code = "return '**** ' + num.slice(-4);"
129. [UI_Logic] Line:494 <template> Binding: for = "mat in materialStatuses"
130. [UI_Structure] Line:495 <div> Class = "['flex flex-col justify-between p-4 rounded-lg border shadow-sm h-36 relative transition', mat.status === 'received' ? 'bg-green-50 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800']"
131. [UI_Structure] Line:497 <div> Class = "space-y-1"
132. [UI_Structure] Line:498 <div> Class = "font-bold text-sm flex items-center gap-2"
133. [UI_Structure] Line:499 <i> Class = "fa-solid fa-file-contract"
134. [UI_Content] Line:499 Text = "{{ mat.name }}"
135. [UI_Structure] Line:501 <div> Class = "text-xs mt-2"
136. [UI_Logic] Line:501 <div> Binding: if = "mat.status === 'received'"
137. [UI_Content] Line:501 Text = "状態: 受領済み"
138. [UI_Structure] Line:502 <div> Class = "text-xs mt-2"
139. [UI_Logic] Line:502 <div> Binding: else
140. [UI_Content] Line:502 Text = "状態: 未受領"
141. [UI_Structure] Line:504 <div> Class = "flex justify-between items-end border-t pt-2"
142. [UI_Logic] Line:504 <div> Binding: class = "mat.status === 'received' ? 'border-green-100' : 'border-red-100'"
143. [UI_Structure] Line:505 <span> Class = "text-xs text-green-600 font-bold"
144. [UI_Logic] Line:505 <span> Binding: if = "mat.status === 'received'"
145. [UI_Content] Line:505 Text = "順調"
146. [UI_Structure] Line:506 <span> Class = "text-xs text-red-600 font-bold"
147. [UI_Logic] Line:506 <span> Binding: else
148. [UI_Content] Line:506 Text = "遅延"
149. [UI_Structure] Line:510 <div> Class = "['flex flex-col justify-between p-4 rounded-lg border shadow-sm h-36 relative transition', c_config.cash ? 'bg-green-50 border-green-200 text-green-800' : 'bg-gray-50 border-gray-200 text-gray-400 opacity-60']"
150. [UI_Structure] Line:512 <div> Class = "space-y-1"
151. [UI_Structure] Line:513 <div> Class = "font-bold text-sm flex items-center gap-2"
152. [UI_Structure] Line:513 <i> Class = "fa-solid fa-book"
153. [UI_Content] Line:513 Text = "現金出納帳"
168. [UI_Content] Line:522 Text = "対象外"
131. [Internal_State_Definition] Line:499 Code = "const isCalendarLoading = ref(false);"
132. [Internal_Logic_Flow] Line:500 Code = "const currentDateMock = moment(); // Strict Today"
133. [Internal_State_Definition] Line:502 Code = "const viewYearStart = ref(2025); // Default start year"
134. [Internal_Computed_Logic] Line:504 Code = "const sortedCalendarDocs = computed(() => {"
135. [Internal_Logic_Flow] Line:506 Code = "const list = clients.value.map((c: Client) => ({"
136. [Internal_Logic_Flow] Line:507 Code = "...c,"
137. [Internal_Logic_Flow] Line:508 Code = "code: c.clientCode,"
138. [Internal_Logic_Flow] Line:509 Code = "name: c.companyName,"
139. [Internal_Logic_Flow] Line:510 Code = "type: 'corp', // Default"
140. [Internal_Logic_Flow] Line:511 Code = "jobId: c.clientCode"
141. [Internal_Logic_Flow] Line:512 Code = "}));"
142. [Internal_Logic_Flow] Line:514 Code = "return list.sort((a, b) => {"
143. [Internal_Logic_Flow] Line:516 Code = "return a.code.localeCompare(b.code);"
144. [Internal_Logic_Flow] Line:517 Code = "});"
145. [Internal_Logic_Flow] Line:518 Code = "});"
146. [Internal_Logic_Flow] Line:520 Code = "const changeYear = (dir: 'next' | 'prev') => {"
147. [Internal_Logic_Flow] Line:521 Code = "isCalendarLoading.value = true;"
148. [Internal_Logic_Flow] Line:522 Code = "setTimeout(() => {"
149. [Internal_Logic_Flow] Line:523 Code = "if (dir === 'next') viewYearStart.value++;"
150. [Internal_Logic_Flow] Line:524 Code = "else viewYearStart.value--;"
151. [Internal_Logic_Flow] Line:526 Code = "isCalendarLoading.value = false;"
152. [Internal_Logic_Flow] Line:527 Code = "}, 400);"
153. [Internal_Logic_Flow] Line:528 Code = "};"
154. [Internal_Logic_Flow] Line:531 Code = "const goToCollectionDetail = (client: any) => {"
155. [Internal_Logic_Flow] Line:532 Code = "router.push({ name: 'ScreenC_Detail', params: { code: client.code } });"
156. [Internal_Logic_Flow] Line:533 Code = "};"
157. [Internal_Logic_Flow] Line:537 Code = "const getDateForCell = (m: number) => {"
158. [Internal_Logic_Flow] Line:538 Code = "const year = m <= 12 ? viewYearStart.value : viewYearStart.value + 1;"
159. [Internal_Logic_Flow] Line:539 Code = "const month = m <= 12 ? m : m - 12;"
160. [Internal_Logic_Flow] Line:540 Code = "return moment(`${year}-${String(month).padStart(2, '0')}-01`);"
161. [Internal_Logic_Flow] Line:541 Code = "};"
162. [Internal_Logic_Flow] Line:544 Code = "const getFiscalTermEnd = (client: any, targetDate: moment.Moment) => {"
163. [Internal_Logic_Flow] Line:545 Code = "const fiscalMonth = client.type === 'individual' ? 12 : client.fiscalMonth;"
164. [Internal_Logic_Flow] Line:546 Code = "const month = targetDate.month() + 1;"
165. [Internal_Logic_Flow] Line:547 Code = "let year = targetDate.year();"
166. [Internal_Logic_Flow] Line:548 Code = "if (month > fiscalMonth) {"
167. [Internal_Logic_Flow] Line:549 Code = "year++;"
168. [Internal_Logic_Flow] Line:550 Code = "}"
169. [Internal_Logic_Flow] Line:551 Code = "return moment(`${year}-${String(fiscalMonth).padStart(2, '0')}-01`).endOf('month');"
170. [Internal_Logic_Flow] Line:552 Code = "};"
171. [Internal_Logic_Flow] Line:555 Code = "const getActiveTerm1End = (client: any) => {"
172. [Internal_Logic_Flow] Line:556 Code = "const checkDate = currentDateMock.clone().subtract(2, 'years');"
173. [Internal_Logic_Flow] Line:557 Code = "const today = currentDateMock;"
174. [Internal_Logic_Flow] Line:559 Code = "for (let i = 0; i < 5; i++) {"
175. [Internal_Logic_Flow] Line:560 Code = "const termEnd = getFiscalTermEnd(client, checkDate);"
176. [Internal_Logic_Flow] Line:561 Code = "const filingOffset = client.type === 'individual' ? 3 : 2;"
177. [Internal_Logic_Flow] Line:562 Code = "const filingDeadline = termEnd.clone().add(filingOffset, 'months').endOf('month');"
178. [Internal_Logic_Flow] Line:564 Code = "if (today.isSameOrBefore(filingDeadline)) {"
179. [Internal_Logic_Flow] Line:565 Code = "return termEnd;"
180. [Internal_Logic_Flow] Line:566 Code = "}"
181. [Internal_Logic_Flow] Line:567 Code = "checkDate.add(1, 'year');"
182. [Internal_Logic_Flow] Line:568 Code = "}"
183. [Internal_Logic_Flow] Line:569 Code = "return getFiscalTermEnd(client, today);"
184. [Internal_Logic_Flow] Line:570 Code = "};"
185. [Internal_Logic_Flow] Line:573 Code = "const getCellStyle = (client: any, m: number) => {"
186. [Internal_Logic_Flow] Line:574 Code = "const cellDate = getDateForCell(m);"
187. [Internal_Logic_Flow] Line:576 Code = "const term1End = getActiveTerm1End(client);"
188. [Internal_Logic_Flow] Line:577 Code = "const term1Start = term1End.clone().subtract(1, 'year').add(1, 'day');"
189. [Internal_Logic_Flow] Line:579 Code = "const term2End = term1End.clone().add(1, 'year');"
190. [Internal_Logic_Flow] Line:580 Code = "const term2Start = term1End.clone().add(1, 'day');"
191. [Internal_Logic_Flow] Line:582 Code = "if (cellDate.isBetween(term1Start, term1End, 'month', '[]')) {"
192. [Internal_Logic_Flow] Line:583 Code = "return 'bg-white'; // Active 1"
193. [Internal_Logic_Flow] Line:584 Code = "}"
194. [Internal_Logic_Flow] Line:585 Code = "if (cellDate.isBetween(term2Start, term2End, 'month', '[]')) {"
195. [Internal_Logic_Flow] Line:586 Code = "return 'bg-blue-50'; // Active 2"
196. [Internal_Logic_Flow] Line:587 Code = "}"
197. [Internal_Logic_Flow] Line:589 Code = "return 'bg-diagonal'; // Inactive"
198. [Internal_Logic_Flow] Line:590 Code = "};"
199. [Internal_Logic_Flow] Line:593 Code = "const shouldShowIcon = (client: any, m: number) => {"
200. [Internal_Logic_Flow] Line:595 Code = "if (getCellStyle(client, m) === 'bg-diagonal') return false;"
201. [Internal_Logic_Flow] Line:598 Code = "const cellDate = getDateForCell(m);"
202. [Internal_Logic_Flow] Line:600 Code = "if (cellDate.isAfter(currentDateMock, 'month')) {"
203. [Internal_Logic_Flow] Line:601 Code = "return false;"
204. [Internal_Logic_Flow] Line:602 Code = "}"
205. [Internal_Logic_Flow] Line:604 Code = "return true;"
206. [Internal_Logic_Flow] Line:605 Code = "};"
207. [Internal_Logic_Flow] Line:613 Code = "const getPeriodStatus = (client: any, m: number): number => {"
208. [Internal_Logic_Flow] Line:614 Code = "const seed = (client.jobId.charCodeAt(2) || 0) + m;"
209. [Internal_Logic_Flow] Line:615 Code = "const mod = seed % 10;"
210. [Internal_Logic_Flow] Line:616 Code = "if (mod < 2) return 0;"
211. [Internal_Logic_Flow] Line:617 Code = "if (mod === 2) return 2;"
212. [Internal_Logic_Flow] Line:618 Code = "return 1;"
213. [Internal_Logic_Flow] Line:619 Code = "};"
214. [Internal_Logic_Flow] Line:622 Code = "const isFiscalMonth = (client: any, m: number): boolean => {"
215. [Internal_Logic_Flow] Line:623 Code = "const month = m <= 12 ? m : m - 12;"
216. [Internal_Logic_Flow] Line:624 Code = "return client.fiscalMonth === month;"
217. [Internal_Logic_Flow] Line:625 Code = "};"
218. [Internal_State_Definition] Line:630 Code = "const c_config = ref({ cash: false, payroll: false, social: false, invoice: false });"
219. [Internal_State_Definition] Line:631 Code = "const c_isSaving = ref(false);"
220. [Internal_State_Definition] Line:632 Code = "const showCReportModal = ref(false);"
221. [Internal_State_Definition] Line:633 Code = "const c_reportText = ref('');"
222. [Internal_Logic_Flow] Line:635 Code = "const goBack = () => {"
223. [Internal_Logic_Flow] Line:636 Code = "router.push({ name: 'ScreenC' });"
224. [Internal_Logic_Flow] Line:637 Code = "};"
225. [Internal_Logic_Flow] Line:639 Code = "const saveCConfig = () => {"
226. [Internal_Logic_Flow] Line:640 Code = "c_isSaving.value = true;"
227. [Internal_Logic_Flow] Line:641 Code = "setTimeout(() => {"
228. [Internal_Logic_Flow] Line:642 Code = "c_isSaving.value = false;"
229. [Internal_Logic_Flow] Line:643 Code = "if (showToast) showToast('設定を保存しました', 'success');"
230. [Internal_Logic_Flow] Line:644 Code = "}, 800);"
231. [Internal_Logic_Flow] Line:645 Code = "};"
232. [Internal_Logic_Flow] Line:647 Code = "const openReportModal = () => {"
233. [Internal_Logic_Flow] Line:648 Code = "if (!currentClient.value) return;"
234. [Internal_Logic_Flow] Line:650 Code = "c_reportText.value = `"
235. [Internal_Logic_Flow] Line:651 Code = "【資料回収報告】 ${currentClient.value.name} 様"
236. [Internal_Logic_Flow] Line:653 Code = "いつも大変お世話になっております。"
237. [Internal_Logic_Flow] Line:654 Code = "${new Date().getMonth() + 1}月分の資料回収状況についてご報告いたします。"
238. [Internal_Logic_Flow] Line:656 Code = "■ 受領済み"
239. [Internal_Logic_Flow] Line:657 Code = "・領収書 (11/25受領)"
240. [Internal_Logic_Flow] Line:658 Code = "${currentClient.value.banks.filter(b => b.status === 'connected').map(b => `・${b.bankName} 通帳コピー`).join('\n') || ''}"
241. [Internal_Logic_Flow] Line:660 Code = "■ 未受領 (至急ご手配ください)"
242. [Internal_Logic_Flow] Line:661 Code = "${currentClient.value.creditCards.filter(c => c.status !== 'connected').map(c => `・${c.companyName} (${c.note || '未着'})`).join('\n') || ''}"
243. [Internal_Logic_Flow] Line:662 Code = "${c_config.value.invoice ? '・請求書' : ''}"
244. [Internal_Logic_Flow] Line:664 Code = "ご確認のほどよろしくお願いいたします。"
245. [Internal_Logic_Flow] Line:665 Code = "`.trim();"
246. [Internal_Logic_Flow] Line:666 Code = "showCReportModal.value = true;"
247. [Internal_Logic_Flow] Line:667 Code = "};"
248. [Internal_Logic_Flow] Line:669 Code = "const copyCReport = () => {"
249. [Internal_Logic_Flow] Line:670 Code = "navigator.clipboard.writeText(c_reportText.value);"
250. [Internal_Logic_Flow] Line:671 Code = "if (showToast) showToast('クリップボードにコピーしました', 'success');"
251. [Internal_Logic_Flow] Line:672 Code = "showCReportModal.value = false;"
252. [Internal_Logic_Flow] Line:673 Code = "};"
253. [Internal_State_Definition] Line:678 Code = "const showBankModal = ref(false);"
254. [Internal_State_Definition] Line:679 Code = "const showCardModal = ref(false);"
255. [Internal_Logic_Flow] Line:681 Code = "const bankForm = reactive({"
256. [Internal_Logic_Flow] Line:682 Code = "bankName: '',"
257. [Internal_Logic_Flow] Line:683 Code = "branchName: '',"
258. [Internal_Logic_Flow] Line:684 Code = "accountNumber: '',"
259. [Internal_Logic_Flow] Line:685 Code = "accountName: ''"
260. [Internal_Logic_Flow] Line:686 Code = "});"
261. [Internal_Logic_Flow] Line:688 Code = "const cardForm = reactive({"
262. [Internal_Logic_Flow] Line:689 Code = "companyName: '',"
263. [Internal_Logic_Flow] Line:690 Code = "cardNumber: '',"
264. [Internal_Logic_Flow] Line:691 Code = "withdrawalAccount: ''"
265. [Internal_Logic_Flow] Line:692 Code = "});"
266. [Internal_Logic_Flow] Line:694 Code = "const openBankModal = () => {"
267. [Internal_Logic_Flow] Line:695 Code = "bankForm.bankName = '';"
268. [Internal_Logic_Flow] Line:696 Code = "bankForm.branchName = '';"
269. [Internal_Logic_Flow] Line:697 Code = "bankForm.accountNumber = '';"
270. [Internal_Logic_Flow] Line:698 Code = "bankForm.accountName = '';"
271. [Internal_Logic_Flow] Line:699 Code = "showBankModal.value = true;"
272. [Internal_Logic_Flow] Line:700 Code = "};"
273. [Internal_Logic_Flow] Line:702 Code = "const openCardModal = () => {"
274. [Internal_Logic_Flow] Line:703 Code = "cardForm.companyName = '';"
275. [Internal_Logic_Flow] Line:704 Code = "cardForm.cardNumber = '';"
276. [Internal_Logic_Flow] Line:705 Code = "cardForm.withdrawalAccount = '';"
277. [Internal_Logic_Flow] Line:706 Code = "showCardModal.value = true;"
278. [Internal_Logic_Flow] Line:707 Code = "};"
279. [Internal_Logic_Flow] Line:709 Code = "const saveBank = async () => {"
280. [Internal_Logic_Flow] Line:710 Code = "if (!currentClient.value) return;"
281. [Internal_Logic_Flow] Line:711 Code = "const clientCode = currentClient.value.code;"
282. [Internal_Logic_Flow] Line:713 Code = "try {"
283. [Internal_Logic_Flow] Line:714 Code = "await FirestoreRepository.addBankAccount(clientCode, {"
284. [Internal_Logic_Flow] Line:715 Code = "bankName: bankForm.bankName,"
285. [Internal_Logic_Flow] Line:716 Code = "branchName: bankForm.branchName,"
286. [Internal_Logic_Flow] Line:717 Code = "accountNumber: bankForm.accountNumber,"
287. [Internal_Logic_Flow] Line:718 Code = "status: 'connected'"
288. [Internal_Logic_Flow] Line:719 Code = "});"
289. [Internal_Logic_Flow] Line:721 Code = "await fetchAssets(clientCode); // Refresh"
290. [Internal_Logic_Flow] Line:722 Code = "if (showToast) showToast('銀行口座を追加しました', 'success');"
291. [Internal_Logic_Flow] Line:723 Code = "showBankModal.value = false;"
292. [Internal_Logic_Flow] Line:724 Code = "} catch(e) {"
293. [Internal_Logic_Flow] Line:725 Code = "console.error(e);"
294. [Internal_Logic_Flow] Line:726 Code = "alert('追加に失敗しました');"
295. [Internal_Logic_Flow] Line:727 Code = "}"
296. [Internal_Logic_Flow] Line:728 Code = "};"
297. [Internal_Logic_Flow] Line:730 Code = "const saveCard = async () => {"
298. [Internal_Logic_Flow] Line:731 Code = "if (!currentClient.value) return;"
299. [Internal_Logic_Flow] Line:732 Code = "const clientCode = currentClient.value.code;"
300. [Internal_Logic_Flow] Line:734 Code = "try {"
301. [Internal_Logic_Flow] Line:735 Code = "await FirestoreRepository.addCreditCard(clientCode, {"
302. [Internal_Logic_Flow] Line:736 Code = "companyName: cardForm.companyName,"
303. [Internal_Logic_Flow] Line:737 Code = "brand: '不明',"
304. [Internal_Logic_Flow] Line:738 Code = "last4Digits: cardForm.cardNumber.slice(-4),"
305. [Internal_Logic_Flow] Line:739 Code = "status: 'connected'"
306. [Internal_Logic_Flow] Line:740 Code = "});"
307. [Internal_Logic_Flow] Line:742 Code = "await fetchAssets(clientCode); // Refresh"
308. [Internal_Logic_Flow] Line:743 Code = "if (showToast) showToast('クレジットカードを追加しました', 'success');"
309. [Internal_Logic_Flow] Line:744 Code = "showCardModal.value = false;"
310. [Internal_Logic_Flow] Line:745 Code = "} catch(e) {"
311. [Internal_Logic_Flow] Line:746 Code = "console.error(e);"
312. [Internal_Logic_Flow] Line:747 Code = "alert('追加に失敗しました');"
313. [Internal_Logic_Flow] Line:748 Code = "}"
314. [Internal_Logic_Flow] Line:749 Code = "};"
315. [Internal_Logic_Flow] Line:751 Code = "const deleteBank = async (id: string) => {"
316. [Internal_Logic_Flow] Line:752 Code = "if (!currentClient.value || !confirm('この銀行口座を削除してもよろしいですか？')) return;"
317. [Internal_Logic_Flow] Line:754 Code = "try {"
318. [Internal_Logic_Flow] Line:755 Code = "await FirestoreRepository.deleteBankAccount(currentClient.value.code, id);"
319. [Internal_Logic_Flow] Line:756 Code = "await fetchAssets(currentClient.value.code); // Refresh"
320. [Internal_Logic_Flow] Line:757 Code = "if (showToast) showToast('銀行口座を削除しました', 'success');"
321. [Internal_Logic_Flow] Line:758 Code = "} catch(e) {"
322. [Internal_Logic_Flow] Line:759 Code = "console.error(e);"
323. [Internal_Logic_Flow] Line:760 Code = "alert('削除に失敗しました');"
324. [Internal_Logic_Flow] Line:761 Code = "}"
325. [Internal_Logic_Flow] Line:762 Code = "};"
326. [Internal_Logic_Flow] Line:764 Code = "const deleteCard = async (id: string) => {"
327. [Internal_Logic_Flow] Line:765 Code = "if (!currentClient.value || !confirm('このクレジットカードを削除してもよろしいですか？')) return;"
328. [Internal_Logic_Flow] Line:767 Code = "try {"
329. [Internal_Logic_Flow] Line:768 Code = "await FirestoreRepository.deleteCreditCard(currentClient.value.code, id);"
330. [Internal_Logic_Flow] Line:769 Code = "await fetchAssets(currentClient.value.code); // Refresh"
331. [Internal_Logic_Flow] Line:770 Code = "if (showToast) showToast('クレジットカードを削除しました', 'success');"
332. [Internal_Logic_Flow] Line:771 Code = "} catch(e) {"
333. [Internal_Logic_Flow] Line:772 Code = "console.error(e);"
334. [Internal_Logic_Flow] Line:773 Code = "alert('削除に失敗しました');"
335. [Internal_Logic_Flow] Line:774 Code = "}"
336. [Internal_Logic_Flow] Line:775 Code = "};"

## Style Definition (Style)
337. [Style_Definition] Line:780 CSS = ".animate-fade-in {"
338. [Style_Definition] Line:781 CSS = "animation: fadeIn 0.4s ease-out forwards;"
339. [Style_Definition] Line:782 CSS = "}"
340. [Style_Definition] Line:783 CSS = ".animate-fade-in-up {"
341. [Style_Definition] Line:784 CSS = "animation: fadeInUp 0.3s ease-out forwards;"
342. [Style_Definition] Line:785 CSS = "}"
343. [Style_Definition] Line:787 CSS = "@keyframes fadeIn {"
344. [Style_Definition] Line:788 CSS = "from { opacity: 0; transform: translateY(10px); }"
345. [Style_Definition] Line:789 CSS = "to { opacity: 1; transform: translateY(0); }"
346. [Style_Definition] Line:790 CSS = "}"
347. [Style_Definition] Line:791 CSS = "@keyframes fadeInUp {"
348. [Style_Definition] Line:792 CSS = "from { opacity: 0; transform: translateY(20px); }"
349. [Style_Definition] Line:793 CSS = "to { opacity: 1; transform: translateY(0); }"
350. [Style_Definition] Line:794 CSS = "}"
351. [Style_Definition] Line:796 CSS = "/* Custom Scrollbar */"
352. [Style_Definition] Line:797 CSS = ".overflow-auto::-webkit-scrollbar {"
353. [Style_Definition] Line:798 CSS = "width: 8px;"
354. [Style_Definition] Line:799 CSS = "height: 8px;"
355. [Style_Definition] Line:800 CSS = "}"
356. [Style_Definition] Line:801 CSS = ".overflow-auto::-webkit-scrollbar-track {"
357. [Style_Definition] Line:802 CSS = "background: #f1f5f9;"
358. [Style_Definition] Line:803 CSS = "}"
359. [Style_Definition] Line:804 CSS = ".overflow-auto::-webkit-scrollbar-thumb {"
360. [Style_Definition] Line:805 CSS = "background: #cbd5e1;"
361. [Style_Definition] Line:806 CSS = "border-radius: 4px;"
362. [Style_Definition] Line:807 CSS = "}"
363. [Style_Definition] Line:809 CSS = "/* Diagonal Pattern - Matches HTML Linear Gradient */"
364. [Style_Definition] Line:810 CSS = ".bg-diagonal {"
365. [Style_Definition] Line:811 CSS = "background-image: linear-gradient(45deg, #f1f5f9 25%, #ffffff 25%, #ffffff 50%, #f1f5f9 50%, #f1f5f9 75%, #ffffff 75%, #ffffff 100%);"
366. [Style_Definition] Line:812 CSS = "background-size: 8px 8px; /* HTML matches 8px */"
367. [Style_Definition] Line:813 CSS = "}"
